<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ç˜¦åˆ°99">
<meta name="mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1A1025" id="metaThemeColor">
<meta name="description" content="æ·±å¤œæƒ³åƒä¸œè¥¿ï¼Ÿæ¥è·Ÿé£Ÿæ¬²å¤§æˆ˜ä¸€åœºï¼æ„å¿—åŠ›é—¯å…³å°æ¸¸æˆ">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi5oul5YiwOTnlsLHpnaDkvaDkuoYiLCJzaG9ydF9uYW1lIjoi5oul5YiwOTkiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzFBMTAyNSIsInRoZW1lX2NvbG9yIjoiIzFBMTAyNSJ9">
<title>ç˜¦åˆ°99å°±é ä½ äº†</title>
<style>
/* ========== å…¨å±€é‡ç½®ä¸åŸºç¡€ ========== */
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
:root {
  --pink: #FF6B9D; --pink-light: #FFB8D0; --pink-dark: #E84580;
  --purple: #A855F7; --purple-light: #D4A5FF; --purple-dark: #7C3AED;
  --blue: #60A5FA; --blue-light: #93C5FD;
  --gold: #FBBF24; --gold-light: #FDE68A;
  --green: #34D399; --green-light: #6EE7B7;
  --red: #F87171; --red-light: #FCA5A5;
  --bg-dark: #1A1025; --bg-card: #2D1F3D; --bg-card2: #3D2A54;
  --text-main: #F5E6FF; --text-sub: #B794D6; --text-dim: #8B6AAE;
  --phase1-color: #60A5FA; --phase1-bg: rgba(96,165,250,0.15);
  --phase2-color: #FBBF24; --phase2-bg: rgba(251,191,36,0.15);
  --phase3-color: #F87171; --phase3-bg: rgba(248,113,113,0.15);
  --phase4-color: #A855F7; --phase4-bg: rgba(168,85,247,0.15);
  --phase5-color: #34D399; --phase5-bg: rgba(52,211,153,0.15);
  --overlay-bg: rgba(10,5,20,0.92); --overlay-bg-heavy: rgba(10,5,20,0.97);
  --tab-bg: rgba(26,16,37,0.97); --tab-border: rgba(168,85,247,0.15);
  --star-color: white; --body-gradient: radial-gradient(ellipse at 50% 0%, rgba(168,85,247,0.15) 0%, transparent 60%);
}
/* ========== æµ…è‰²ä¸»é¢˜ ========== */
body.light {
  --bg-dark: #FFF5F9; --bg-card: #FFFFFF; --bg-card2: #FFF0F5;
  --text-main: #3D2054; --text-sub: #7C5A9E; --text-dim: #A88EC4;
  --phase1-color: #3B82F6; --phase1-bg: rgba(59,130,246,0.1);
  --phase2-color: #D97706; --phase2-bg: rgba(217,119,6,0.1);
  --phase3-color: #EF4444; --phase3-bg: rgba(239,68,68,0.1);
  --phase4-color: #7C3AED; --phase4-bg: rgba(124,58,237,0.1);
  --phase5-color: #059669; --phase5-bg: rgba(5,150,105,0.1);
  --overlay-bg: rgba(255,245,249,0.95); --overlay-bg-heavy: rgba(255,245,249,0.98);
  --tab-bg: rgba(255,255,255,0.97); --tab-border: rgba(168,85,247,0.1);
  --star-color: rgba(168,85,247,0.3); --body-gradient: radial-gradient(ellipse at 50% 0%, rgba(255,107,157,0.08) 0%, transparent 60%);
}
body.light .food-card { box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
body.light .food-card.selected { background: rgba(255,107,157,0.08); }
body.light .will-report-card { box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
body.light .badge-card { box-shadow: 0 1px 4px rgba(0,0,0,0.05); }
body.light .cat-chip.active { background: rgba(168,85,247,0.1); }
body.light .will-stat { background: rgba(168,85,247,0.04); }
body.light .encourage-card { background: linear-gradient(135deg, rgba(255,107,157,0.08), rgba(168,85,247,0.08)); border-color: rgba(255,107,157,0.1); }
body.light .encourage-text { color: var(--pink-dark); }
body.light .streak-dot.future { background: #F3E8FF; }
body.light .streak-dot.today { background: #FFF; border-color: var(--gold); }
body.light .choice-continue { background: #FFF0F5; color: var(--text-sub); border-color: rgba(168,85,247,0.15); }
body.light .mode-panel, body.light .blindbox-card, body.light .victory-report { box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
body.light .battle-curse { background: rgba(0,0,0,0.03); }
body.light .battle-food-tag { background: rgba(255,107,157,0.08); }
body.light .report-row { border-bottom-color: rgba(0,0,0,0.05); }
body.light .phase-bar-bg { background: rgba(0,0,0,0.06); }

/* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
.theme-toggle { position: fixed; top: 12px; right: 12px; z-index: 150; width: 36px; height: 36px; border-radius: 50%; border: none; background: var(--bg-card); color: var(--text-main); font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.15); transition: all 0.3s; }
.theme-toggle:active { transform: scale(0.9); }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
  background: var(--bg-dark); color: var(--text-main); min-height: 100vh; overflow-x: hidden;
  background-image: var(--body-gradient); transition: background 0.4s, color 0.4s;
}

/* ========== å®‰å…¨åŒºåŸŸé€‚é… ========== */
html { height: -webkit-fill-available; }
body { min-height: -webkit-fill-available; padding-top: env(safe-area-inset-top); }

/* ========== é¡µé¢å®¹å™¨ ========== */
.page { display: none; flex-direction: column; height: calc(100vh - 56px - env(safe-area-inset-bottom)); animation: fadeIn 0.3s ease; overflow: hidden; }
.page.active { display: flex; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* ========== æ¬¢è¿é¡µ ========== */
#page-welcome { justify-content: center; align-items: center; text-align: center; padding: 20px; height: 100vh; }
.welcome-moon { font-size: 80px; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
.welcome-stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
.star { position: absolute; background: var(--star-color); border-radius: 50%; animation: twinkle 2s ease-in-out infinite; }
@keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
.welcome-title { font-size: 32px; font-weight: 900; background: linear-gradient(135deg, var(--pink), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px; position: relative; z-index: 1; }
.welcome-sub { font-size: 15px; color: var(--text-sub); margin-bottom: 40px; line-height: 1.6; position: relative; z-index: 1; }
.welcome-btn { background: linear-gradient(135deg, var(--pink), var(--purple)); color: white; border: none; padding: 16px 48px; border-radius: 50px; font-size: 18px; font-weight: 700; cursor: pointer; position: relative; z-index: 1; box-shadow: 0 8px 30px rgba(168,85,247,0.4); transition: transform 0.2s, box-shadow 0.2s; }
.welcome-btn:active { transform: scale(0.95); box-shadow: 0 4px 15px rgba(168,85,247,0.3); }
.welcome-tip { margin-top: 30px; font-size: 12px; color: var(--text-dim); position: relative; z-index: 1; }

/* ========== åº•éƒ¨ Tab æ  ========== */
.tab-bar { position: fixed; bottom: 0; left: 0; right: 0; height: calc(56px + env(safe-area-inset-bottom)); background: var(--tab-bg); backdrop-filter: blur(20px); border-top: 1px solid var(--tab-border); display: none; justify-content: space-around; align-items: flex-start; padding-top: 6px; z-index: 100; padding-bottom: env(safe-area-inset-bottom); }
.tab-bar.visible { display: flex; }
.tab-item { display: flex; flex-direction: column; align-items: center; gap: 1px; cursor: pointer; padding: 5px 28px; border-radius: 12px; transition: all 0.2s; }
.tab-item.active { background: rgba(168,85,247,0.12); }
.tab-icon { font-size: 20px; }
.tab-label { font-size: 10px; color: var(--text-dim); font-weight: 500; }
.tab-item.active .tab-label { color: var(--purple-light); font-weight: 700; }

/* ========== æƒ³åƒé¡µ - é£Ÿç‰©é€‰æ‹© ========== */
#page-food { padding: 0; }
.food-header { padding: 16px 16px 8px; text-align: center; flex-shrink: 0; }
.food-header h2 { font-size: 20px; font-weight: 800; margin-bottom: 2px; }
.food-header p { font-size: 12px; color: var(--text-sub); }
.food-categories { display: flex; gap: 6px; padding: 6px 16px; overflow-x: auto; -webkit-overflow-scrolling: touch; flex-shrink: 0; }
.food-categories::-webkit-scrollbar { display: none; }
.cat-chip { flex-shrink: 0; padding: 5px 14px; border-radius: 18px; background: var(--bg-card); color: var(--text-sub); font-size: 12px; font-weight: 600; cursor: pointer; border: 1.5px solid transparent; transition: all 0.3s; white-space: nowrap; }
.cat-chip.active { background: rgba(168,85,247,0.2); color: var(--purple-light); border-color: var(--purple); }
.food-grid-wrap { flex: 1; overflow-y: auto; padding: 10px 12px 10px; -webkit-overflow-scrolling: touch; }
.food-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
.food-card { background: var(--bg-card); border-radius: 12px; padding: 10px 4px 8px; text-align: center; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; position: relative; overflow: hidden; }
.food-card:active { transform: scale(0.93); }
.food-card.selected { border-color: var(--pink); background: rgba(255,107,157,0.1); }
.food-card.selected::after { content: 'âœ“'; position: absolute; top: 2px; right: 4px; font-size: 10px; color: var(--pink); font-weight: 900; }
.food-emoji { font-size: 30px; display: block; margin-bottom: 2px; }
.food-name { font-size: 11px; font-weight: 600; color: var(--text-main); line-height: 1.2; }
.food-cal { font-size: 9px; color: var(--text-dim); margin-top: 1px; }

/* å·²é€‰ç»Ÿè®¡æ¡ */
.food-stats-bar { flex-shrink: 0; background: var(--tab-bg); backdrop-filter: blur(15px); padding: 8px 14px; border-top: 1px solid var(--tab-border); display: flex; align-items: center; gap: 10px; }
.stats-info { flex: 1; }
.stats-info .cal-num { font-size: 18px; font-weight: 800; color: var(--pink); }
.stats-info .cal-label { font-size: 10px; color: var(--text-dim); }
.stats-info .run-equiv { font-size: 10px; color: var(--gold); margin-top: 1px; }
.start-battle-btn { background: linear-gradient(135deg, var(--pink), var(--purple)); color: white; border: none; padding: 10px 24px; border-radius: 22px; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
.start-battle-btn:disabled { opacity: 0.4; cursor: not-allowed; }
.start-battle-btn:active:not(:disabled) { transform: scale(0.95); }

/* ========== æ¨¡å¼é€‰æ‹©æµ®å±‚ ========== */
.mode-overlay { position: fixed; inset: 0; background: var(--overlay-bg); z-index: 200; display: none; justify-content: center; align-items: center; padding: 20px; }
.mode-overlay.show { display: flex; }
.mode-panel { background: var(--bg-card); border-radius: 24px; padding: 28px 18px; width: 100%; max-width: 360px; text-align: center; animation: popIn 0.3s ease; }
@keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.mode-panel h3 { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
.mode-panel .mode-subtitle { font-size: 13px; color: var(--text-sub); margin-bottom: 20px; }
.mode-cards { display: flex; gap: 12px; }
.mode-card { flex: 1; padding: 20px 10px; border-radius: 18px; cursor: pointer; transition: all 0.2s; border: 2.5px solid transparent; }
.mode-card:active { transform: scale(0.95); }
.mode-card.savage { background: linear-gradient(180deg, rgba(248,113,113,0.15), rgba(239,68,68,0.05)); }
.mode-card.savage:hover, .mode-card.savage:active { border-color: var(--red); }
.mode-card.goddess { background: linear-gradient(180deg, rgba(168,85,247,0.15), rgba(236,72,153,0.05)); }
.mode-card.goddess:hover, .mode-card.goddess:active { border-color: var(--purple); }
.mode-card .mode-icon { font-size: 48px; margin-bottom: 8px; }
.mode-card .mode-name { font-size: 16px; font-weight: 800; margin-bottom: 4px; }
.mode-card .mode-desc { font-size: 11px; color: var(--text-sub); line-height: 1.5; }
.mode-cancel { margin-top: 16px; background: none; border: none; color: var(--text-dim); font-size: 13px; cursor: pointer; padding: 8px; }

/* ========== é—¯å…³é¡µ ========== */
#page-battle { padding: 0; height: 100vh; }
.battle-top { padding: 12px 16px 8px; display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.battle-back { font-size: 20px; cursor: pointer; padding: 4px 8px; }
.battle-phase-label { font-size: 12px; font-weight: 700; padding: 4px 12px; border-radius: 20px; }
.battle-level-num { margin-left: auto; font-size: 12px; color: var(--text-sub); font-weight: 600; }
.phase-progress { padding: 0 16px 8px; flex-shrink: 0; }
.phase-bar-bg { height: 5px; border-radius: 3px; background: rgba(255,255,255,0.06); overflow: hidden; }
.phase-bar-fill { height: 100%; border-radius: 3px; transition: width 0.5s ease; }
/* é˜¶æ®µæŒ‡ç¤ºå™¨ */
.phase-indicators { display: flex; gap: 4px; padding: 0 16px 10px; flex-shrink: 0; }
.phase-dot { flex: 1; height: 3px; border-radius: 2px; opacity: 0.25; transition: opacity 0.3s; }
.phase-dot.active { opacity: 1; }
.phase-dot.passed { opacity: 0.6; }

/* é—¯å…³ä¸»ä½“ */
.battle-body { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 12px 20px 20px; text-align: center; overflow-y: auto; }
.battle-scene { font-size: 90px; margin-bottom: 12px; animation: float 3s ease-in-out infinite; }
.battle-curse { font-size: 13px; color: var(--text-dim); margin-bottom: 14px; padding: 6px 16px; background: rgba(255,255,255,0.04); border-radius: 12px; display: inline-block; }
.battle-food-tag { display: inline-flex; align-items: center; gap: 4px; font-size: 12px; color: var(--pink-light); background: rgba(255,107,157,0.1); padding: 4px 12px; border-radius: 12px; margin-bottom: 12px; }
.battle-text { font-size: 24px; font-weight: 900; line-height: 1.5; margin-bottom: 28px; padding: 0 4px; transition: color 0.3s; }
.battle-choices { width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 10px; }
.choice-btn { padding: 13px 18px; border-radius: 16px; border: none; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.2s; }
.choice-btn:active { transform: scale(0.96); }
.choice-give-up { background: linear-gradient(135deg, var(--green), #059669); color: white; box-shadow: 0 4px 20px rgba(52,211,153,0.25); }
.choice-continue { background: var(--bg-card2); color: var(--text-sub); border: 1.5px solid rgba(255,255,255,0.08); }

/* ========== ç›²ç›’/çˆ†ç‚¸å¡ç‰‡ ========== */
.blindbox-overlay { position: fixed; inset: 0; background: var(--overlay-bg); z-index: 250; display: none; justify-content: center; align-items: center; padding: 20px; }
.blindbox-overlay.show { display: flex; }
.blindbox-card { background: var(--bg-card); border-radius: 24px; padding: 28px 20px; width: 100%; max-width: 340px; text-align: center; animation: shakeIn 0.5s ease; border: 2px solid; }
@keyframes shakeIn { 0% { transform: scale(0) rotate(-15deg); } 50% { transform: scale(1.1) rotate(5deg); } 100% { transform: scale(1) rotate(0); } }
.blindbox-boom { font-size: 60px; margin-bottom: 10px; }
.blindbox-title { font-size: 20px; font-weight: 900; margin-bottom: 6px; }
.blindbox-msg { font-size: 15px; color: var(--text-main); line-height: 1.6; margin-bottom: 6px; }
.blindbox-badge-preview { font-size: 12px; color: var(--gold); margin-bottom: 14px; background: rgba(251,191,36,0.1); padding: 6px 14px; border-radius: 12px; display: inline-block; }
.blindbox-close { background: var(--bg-card2); color: var(--text-main); border: none; padding: 10px 28px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; }

/* ========== èƒœåˆ©é¡µ ========== */
.victory-overlay { position: fixed; inset: 0; background: var(--overlay-bg-heavy); z-index: 300; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 24px; text-align: center; overflow-y: auto; }
.victory-overlay.show { display: flex; }
@keyframes confetti { 0% { transform: translateY(-10px) rotate(0deg); opacity: 1; } 100% { transform: translateY(20px) rotate(360deg); opacity: 0; } }
.victory-emoji { font-size: 72px; animation: float 2s ease-in-out infinite; margin-bottom: 12px; }
.victory-title { font-size: 26px; font-weight: 900; background: linear-gradient(135deg, var(--gold), var(--pink)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 6px; }
.victory-sub { font-size: 14px; color: var(--text-sub); line-height: 1.6; margin-bottom: 20px; max-width: 300px; }
.victory-report { background: var(--bg-card); border-radius: 20px; padding: 18px; width: 100%; max-width: 300px; margin-bottom: 20px; border: 1px solid rgba(168,85,247,0.15); }
.report-row { display: flex; justify-content: space-between; padding: 7px 0; border-bottom: 1px solid rgba(255,255,255,0.04); font-size: 13px; }
.report-row:last-child { border: none; }
.report-label { color: var(--text-sub); }
.report-value { font-weight: 700; color: var(--gold); }
.victory-btn { background: linear-gradient(135deg, var(--purple), var(--pink)); color: white; border: none; padding: 13px 36px; border-radius: 25px; font-size: 15px; font-weight: 700; cursor: pointer; box-shadow: 0 6px 25px rgba(168,85,247,0.3); }
.victory-btn:active { transform: scale(0.95); }
.victory-new-badges { margin-bottom: 16px; }
.victory-new-badges .new-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(251,191,36,0.1); padding: 6px 14px; border-radius: 14px; font-size: 13px; color: var(--gold); margin: 4px; }

/* ========== æˆå°±é¡µ ========== */
#page-achieve { padding: 16px 14px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
.achieve-header { text-align: center; margin-bottom: 16px; }
.achieve-header h2 { font-size: 20px; font-weight: 800; margin-bottom: 2px; }
.achieve-header p { font-size: 12px; color: var(--text-sub); }

.will-report-card { background: linear-gradient(135deg, var(--bg-card), var(--bg-card2)); border-radius: 18px; padding: 16px; margin-bottom: 16px; border: 1px solid rgba(168,85,247,0.15); }
.will-report-card h3 { font-size: 15px; font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
.will-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
.will-stat { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 12px 8px; text-align: center; }
.will-stat .num { font-size: 26px; font-weight: 900; }
.will-stat .num.pink { color: var(--pink); }
.will-stat .num.purple { color: var(--purple); }
.will-stat .num.gold { color: var(--gold); }
.will-stat .num.green { color: var(--green); }
.will-stat .label { font-size: 10px; color: var(--text-dim); margin-top: 2px; }

.encourage-card { background: linear-gradient(135deg, rgba(255,107,157,0.1), rgba(168,85,247,0.1)); border-radius: 16px; padding: 16px; margin-bottom: 16px; text-align: center; border: 1px solid rgba(255,107,157,0.15); }
.encourage-emoji { font-size: 36px; margin-bottom: 6px; }
.encourage-text { font-size: 14px; font-weight: 700; line-height: 1.6; color: var(--pink-light); }

.streak-section { margin-bottom: 16px; }
.streak-section h3 { font-size: 15px; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
.streak-grid { display: flex; gap: 5px; flex-wrap: wrap; }
.streak-dot { width: 34px; height: 34px; border-radius: 9px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; }
.streak-dot.done { background: linear-gradient(135deg, var(--pink), var(--purple)); color: white; }
.streak-dot.today { background: var(--bg-card2); color: var(--gold); border: 2px solid var(--gold); }
.streak-dot.future { background: var(--bg-card); color: var(--text-dim); }

.badge-section { margin-bottom: 20px; }
.badge-section h3 { font-size: 15px; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
.badge-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.badge-card { background: var(--bg-card); border-radius: 14px; padding: 12px 6px; text-align: center; position: relative; transition: all 0.3s; }
.badge-card.locked { opacity: 0.3; filter: grayscale(1); }
.badge-card.earned { border: 1px solid rgba(251,191,36,0.2); }
.badge-icon { font-size: 32px; margin-bottom: 4px; }
.badge-name { font-size: 10px; font-weight: 700; color: var(--text-main); }
.badge-cond { font-size: 8px; color: var(--text-dim); margin-top: 1px; line-height: 1.3; }

/* ========== åŠ¨ç”» ========== */
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-6px); } 40%, 80% { transform: translateX(6px); } }
.shake { animation: shake 0.4s ease; }
@keyframes glow { 0%, 100% { box-shadow: 0 0 5px rgba(255,107,157,0.3); } 50% { box-shadow: 0 0 20px rgba(255,107,157,0.6); } }

/* ========== æ»šåŠ¨æ¡ç¾åŒ– ========== */
::-webkit-scrollbar { width: 0; height: 0; }
</style>
</head>
<body>

<!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
<button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">ğŸŒ™</button>

<!-- ==================== æ¬¢è¿é¡µ ==================== -->
<div id="page-welcome" class="page active">
  <div class="welcome-stars" id="stars"></div>
  <div class="welcome-moon">ğŸŒ™</div>
  <h1 class="welcome-title">ç˜¦åˆ°99å°±é ä½ äº†</h1>
  <p class="welcome-sub">æ·±å¤œå˜´é¦‹äº†ï¼Ÿ<br>æ¥ï¼Œè·Ÿä½ çš„é£Ÿæ¬²å¤§æˆ˜ä¸€åœºï¼</p>
  <button class="welcome-btn" onclick="enterApp()">æ·±å¤œæƒ³åƒä¸œè¥¿ï¼Ÿç‚¹æˆ‘</button>
  <p class="welcome-tip">æ„å¿—åŠ›é—¯å…³ Â· è¶Šæ—©æ”¾ä¸‹è¶Šæ˜¯å¥³ç¥</p>
</div>

<!-- ==================== æƒ³åƒé¡µ - é£Ÿç‰©é€‰æ‹© ==================== -->
<div id="page-food" class="page">
  <div class="food-header">
    <h2>ä½ ç°åœ¨åˆ°åº•æƒ³åƒä»€ä¹ˆï¼Ÿ</h2>
    <p>é€‰å‡ºè®©ä½ å£æ°´ç›´æµçš„ç½ªæ¶ç¾é£Ÿå§</p>
  </div>
  <div class="food-categories" id="foodCats"></div>
  <div class="food-grid-wrap">
    <div class="food-grid" id="foodGrid"></div>
  </div>
  <div class="food-stats-bar">
    <div class="stats-info">
      <div><span class="cal-num" id="totalCal">0</span> <span class="cal-label">åƒå¡ç½ªæ¶å€¼</span></div>
      <div class="run-equiv">ğŸƒâ€â™€ï¸ ç›¸å½“äºè·‘ <span id="totalRun">0</span> å…¬é‡Œ</div>
    </div>
    <button class="start-battle-btn" id="startBattleBtn" disabled onclick="showModeSelect()">å¼€å§‹é—¯å…³ â†’</button>
  </div>
</div>

<!-- ==================== æ¨¡å¼é€‰æ‹©æµ®å±‚ ==================== -->
<div class="mode-overlay" id="modeOverlay">
  <div class="mode-panel">
    <h3>é€‰æ‹©é€šå…³æ¨¡å¼</h3>
    <p class="mode-subtitle">æ„å¿—åŠ›æ¸¸æˆï¼Œç°åœ¨å¼€å§‹</p>
    <div class="mode-cards">
      <div class="mode-card savage" onclick="startBattle('savage')">
        <div class="mode-icon">ğŸ‘¿</div>
        <div class="mode-name">æ¯’èˆŒæ¨¡å¼</div>
        <div class="mode-desc">æ‰å¿ƒç‹ è¯æš´å‡»<br>éª‚é†’ä½ çš„é£Ÿæ¬²</div>
      </div>
      <div class="mode-card goddess" onclick="startBattle('goddess')">
        <div class="mode-icon">ğŸ‘¸</div>
        <div class="mode-name">å¥³ç¥æ¨¡å¼</div>
        <div class="mode-desc">æ¸©æŸ”æ­£å‘é¼“åŠ±<br>åšæœ€ç¾çš„è‡ªå·±</div>
      </div>
    </div>
    <button class="mode-cancel" onclick="closeModeSelect()">å†æƒ³æƒ³...</button>
  </div>
</div>

<!-- ==================== é—¯å…³é¡µ ==================== -->
<div id="page-battle" class="page">
  <div class="battle-top">
    <div class="battle-back" onclick="confirmExit()">â†</div>
    <span class="battle-phase-label" id="phaseLabel">å¿ƒç†é˜²çº¿æœŸ</span>
    <span class="battle-level-num" id="levelNum">æŠµæŠ—ç¬¬ 1 æ³¢</span>
  </div>
  <div class="phase-progress">
    <div class="phase-bar-bg"><div class="phase-bar-fill" id="phaseBar"></div></div>
  </div>
  <div class="phase-indicators" id="phaseIndicators"></div>
  <div class="battle-body">
    <div class="battle-scene" id="battleScene">ğŸ•</div>
    <div class="battle-food-tag" id="battleFoodTag">ğŸ— ä½ æƒ³åƒçš„ï¼šç‚¸é¸¡æŸ³</div>
    <div class="battle-curse" id="battleCurse">åƒäº†è¿™å£çš„è¯...</div>
    <div class="battle-text" id="battleText">ä½ çš„è…°å›´æ­£åœ¨é»˜é»˜è®°è´¦ï¼Œæ¯ä¸€å£éƒ½æ˜¯ä¸€ç¬”è¿˜ä¸æ¸…çš„"è„‚è‚ªè´·"ã€‚</div>
    <div class="battle-choices">
      <button class="choice-btn choice-give-up" onclick="giveUpEating()">âœ¨ æˆ‘ä¸åƒäº†ï¼åšå¥³ç¥</button>
      <button class="choice-btn choice-continue" onclick="nextLevel()">ğŸ˜¤ ä¸è¡Œï¼Œè¿˜æ˜¯æƒ³åƒ...</button>
    </div>
  </div>
</div>

<!-- ==================== ç›²ç›’å¼¹çª— ==================== -->
<div class="blindbox-overlay" id="blindboxOverlay">
  <div class="blindbox-card" id="blindboxCard">
    <div class="blindbox-boom" id="bbBoom">ğŸ’¥</div>
    <div class="blindbox-title" id="bbTitle">è­¦å‘Šï¼</div>
    <div class="blindbox-msg" id="bbMsg">ä½ å·²ç»æŒ£æ‰äº†è¿™ä¹ˆä¹…ï¼Œä½ çš„èº«ä½“åœ¨å“€åšï¼</div>
    <div class="blindbox-badge-preview" id="bbBadge">ğŸ… ç°åœ¨æ”¾å¼ƒåƒä¸œè¥¿ï¼Œå¯è·å¾—ã€Œé’¢é“æ„å¿—ã€å¾½ç« </div>
    <button class="blindbox-close" onclick="closeBlindbox()">æˆ‘çŸ¥é“äº†ï¼Œç»§ç»­é—¯å…³</button>
  </div>
</div>

<!-- ==================== èƒœåˆ©é¡µ ==================== -->
<div class="victory-overlay" id="victoryOverlay">
  <div class="victory-emoji" id="victoryEmoji">ğŸ‰</div>
  <div class="victory-title" id="victoryTitle">è€¶ï¼åˆåšæŒä½äº†ï¼</div>
  <div class="victory-sub" id="victorySub">æ­å–œå¥³ç¥ï¼Œä½ æˆ˜èƒœäº†æ·±å¤œé£Ÿæ¬²çš„è¯±æƒ‘ï¼</div>
  <div class="victory-new-badges" id="victoryBadges"></div>
  <div class="victory-report">
    <div class="report-row"><span class="report-label">æŠµæŠ—æ³¢æ•°</span><span class="report-value" id="rptWaves">3</span></div>
    <div class="report-row"><span class="report-label">èŠ‚çœçƒ­é‡</span><span class="report-value" id="rptCal">520 åƒå¡</span></div>
    <div class="report-row"><span class="report-label">å°‘é•¿è„‚è‚ª</span><span class="report-value" id="rptFat">0.07 æ–¤</span></div>
    <div class="report-row"><span class="report-label">æ„å¿—åŠ›è¯„çº§</span><span class="report-value" id="rptGrade">â­â­â­â­â­</span></div>
  </div>
  <button class="victory-btn" onclick="closeVictory()">å›åˆ°é¦–é¡µï¼Œç»§ç»­å˜ç¾ âœ¨</button>
</div>

<!-- ==================== æˆå°±é¡µ ==================== -->
<div id="page-achieve" class="page">
  <div class="achieve-header">
    <h2>æˆ‘çš„æˆå°±</h2>
    <p>æ¯ä¸€æ¬¡å¿ä½ï¼Œéƒ½æ˜¯å˜ç¾çš„å‹‹ç« </p>
  </div>
  <div class="encourage-card" id="encourageCard">
    <div class="encourage-emoji">ğŸ’ª</div>
    <div class="encourage-text">ä»Šå¤©åˆæ˜¯å˜ç¾çš„ä¸€å¤©~<br>ä¿æŒä½ï¼Œä½ æ˜¯æœ€æ£’çš„ï¼</div>
  </div>
  <div class="will-report-card">
    <h3>ğŸ“Š æ„å¿—åŠ›æŠ¥å‘Š</h3>
    <div class="will-stats">
      <div class="will-stat"><div class="num pink" id="achTotal">0</div><div class="label">ç´¯è®¡æŠµæŠ—æ¬¡æ•°</div></div>
      <div class="will-stat"><div class="num purple" id="achStreak">0</div><div class="label">è¿ç»­æ‰“å¡å¤©æ•°</div></div>
      <div class="will-stat"><div class="num gold" id="achCal">0</div><div class="label">ç´¯è®¡èŠ‚çœåƒå¡</div></div>
      <div class="will-stat"><div class="num green" id="achFat">0</div><div class="label">å°‘é•¿è„‚è‚ª(æ–¤)</div></div>
    </div>
  </div>
  <div class="streak-section">
    <h3>ğŸ“… æ‰“å¡è®°å½•</h3>
    <div class="streak-grid" id="streakGrid"></div>
  </div>
  <div class="badge-section">
    <h3>ğŸ… å¾½ç« å¢™</h3>
    <div class="badge-grid" id="badgeGrid"></div>
  </div>
</div>

<!-- ==================== åº•éƒ¨ Tab ==================== -->
<div class="tab-bar" id="tabBar">
  <div class="tab-item active" onclick="switchTab('food')" id="tab-food">
    <span class="tab-icon">ğŸ”</span>
    <span class="tab-label">æƒ³åƒ</span>
  </div>
  <div class="tab-item" onclick="switchTab('achieve')" id="tab-achieve">
    <span class="tab-icon">ğŸ†</span>
    <span class="tab-label">æˆå°±</span>
  </div>
</div>

<script>
// ==================== æ•°æ®å®šä¹‰ ====================

const FOOD_DATA = {
  'ğŸ§‹ å¥¶èŒ¶ç”œé¥®': [
    {name:'çç å¥¶èŒ¶',emoji:'ğŸ§‹',cal:450},{name:'èŠ‹æ³¥å•µå•µ',emoji:'ğŸ¥¤',cal:520},{name:'æ¨æç”˜éœ²',emoji:'ğŸ¥­',cal:380},
    {name:'çƒ§ä»™è‰',emoji:'ğŸ®',cal:350},{name:'èŠèŠè“è“',emoji:'ğŸ“',cal:420},{name:'å¤šè‚‰è‘¡è„',emoji:'ğŸ‡',cal:400},
    {name:'å¯å¯å¥¶èŒ¶',emoji:'ğŸ«',cal:480},{name:'æŠ¹èŒ¶æ‹¿é“',emoji:'ğŸµ',cal:360},{name:'çº¢è±†å¥¶èŒ¶',emoji:'ğŸ«˜',cal:410},
    {name:'é»‘ç³–é¹¿ä¸¸',emoji:'ğŸŸ¤',cal:500},{name:'æ¤°æ¤°å¥¶å†»',emoji:'ğŸ¥¥',cal:390},{name:'æ¡ƒæ¡ƒä¹Œé¾™',emoji:'ğŸ‘',cal:320},
    {name:'èŠ’æœå†°æ²™',emoji:'ğŸ¥­',cal:340},{name:'è‰è“æ˜Ÿå†°ä¹',emoji:'ğŸ“',cal:460},{name:'ç„¦ç³–ç›å¥‡æœµ',emoji:'â˜•',cal:380},
    {name:'èœœæ¡ƒå››å­£æ˜¥',emoji:'ğŸ‘',cal:300},{name:'æŸ æª¬èŒ¶',emoji:'ğŸ‹',cal:250},{name:'è¥¿ç“œæ±',emoji:'ğŸ‰',cal:200},
    {name:'è”æå†°èŒ¶',emoji:'ğŸ«§',cal:280},{name:'è¡€ç³¯ç±³å¥¶èŒ¶',emoji:'ğŸš',cal:440},{name:'é…¸å¥¶ç´«ç±³éœ²',emoji:'ğŸ¥›',cal:360},
    {name:'ç™¾é¦™æœèŒ¶',emoji:'ğŸ«',cal:260},{name:'èœœé›ªå†°åŸ',emoji:'ğŸ¦',cal:350},{name:'æ¤°å­æ°´',emoji:'ğŸ¥¥',cal:180},
    {name:'çº¢èŒ¶ç›å¥‡æœµ',emoji:'ğŸ«–',cal:400},{name:'æ³¢éœ¸å¥¶ç»¿',emoji:'ğŸµ',cal:430},{name:'èŠ‹åœ†å¥¶èŒ¶',emoji:'ğŸŸ£',cal:470},
    {name:'é²œæ¦¨æ©™æ±',emoji:'ğŸŠ',cal:220},{name:'ææ‹‰ç±³è‹å¥¶èŒ¶',emoji:'ğŸ°',cal:510},{name:'é»‘æ£®æ—å¥¶èŒ¶',emoji:'ğŸŒ²',cal:490},
    {name:'å¥¥åˆ©å¥¥å¥¶æ˜”',emoji:'ğŸª',cal:530},{name:'åŒçš®å¥¶',emoji:'ğŸ®',cal:300},{name:'å†°ç³–é›ªæ¢¨',emoji:'ğŸ',cal:180},
    {name:'èœ‚èœœæŸšå­èŒ¶',emoji:'ğŸ¯',cal:240},{name:'æ¡‚èŠ±é…’é…¿',emoji:'ğŸŒ¸',cal:280},{name:'ç«ç‘°å¥¶èŒ¶',emoji:'ğŸŒ¹',cal:370},
    {name:'å’¸è›‹é»„å¥¶èŒ¶',emoji:'ğŸ¥š',cal:460},{name:'è½¦å˜å­å¥¶æ˜”',emoji:'ğŸ’',cal:400},{name:'é¦™èŠ‹éº»è–¯',emoji:'ğŸŸª',cal:450},
    {name:'çº¢ä¸ç»’æ‹¿é“',emoji:'â¤ï¸',cal:420},{name:'è–„è·å·§å…‹åŠ›',emoji:'ğŸƒ',cal:480},{name:'ç•ªçŸ³æ¦´æ±',emoji:'ğŸŸ¢',cal:200},
    {name:'ç«é¾™æœå†°æ²™',emoji:'ğŸ‰',cal:260},{name:'è èå†°èŒ¶',emoji:'ğŸ',cal:290},{name:'ç‰›æ²¹æœå¥¶æ˜”',emoji:'ğŸ¥‘',cal:380},
    {name:'è‰è“é…¸å¥¶',emoji:'ğŸ“',cal:320},{name:'èŠ’æœç­æˆŸ',emoji:'ğŸ¥',cal:400},{name:'ç»¿è±†æ²™å†°',emoji:'ğŸ’š',cal:270},
    {name:'æ¡‘è‘šæ°”æ³¡æ°´',emoji:'ğŸ«§',cal:190},{name:'æ¤°å¥¶è¥¿ç±³éœ²',emoji:'ğŸ¥¥',cal:350},
  ],
  'ğŸ— ç‚¸ç‰©å°åƒ': [
    {name:'ç‚¸é¸¡æŸ³',emoji:'ğŸ—',cal:380},{name:'ç‚¸é¸¡ç¿…',emoji:'ğŸ—',cal:420},{name:'ç‚¸é¸¡æ’',emoji:'ğŸ–',cal:500},
    {name:'è–¯æ¡',emoji:'ğŸŸ',cal:360},{name:'é¸¡ç±³èŠ±',emoji:'ğŸ§†',cal:340},{name:'ç‚¸é¸¡è…¿',emoji:'ğŸ—',cal:480},
    {name:'ç‚¸å¹´ç³•',emoji:'ğŸŸ«',cal:300},{name:'ç‚¸çº¢è–¯ä¸¸',emoji:'ğŸŸ ',cal:280},{name:'ç‚¸è‡­è±†è…',emoji:'ğŸŸ¨',cal:350},
    {name:'ç‚¸é±¿é±¼é¡»',emoji:'ğŸ¦‘',cal:320},{name:'ç‚¸è™¾',emoji:'ğŸ¤',cal:400},{name:'æ˜¥å·',emoji:'ğŸ¥Ÿ',cal:260},
    {name:'ç‚¸è˜‘è‡',emoji:'ğŸ„',cal:240},{name:'æ´‹è‘±åœˆ',emoji:'â­•',cal:310},{name:'ç‚¸é¦™è•‰',emoji:'ğŸŒ',cal:290},
    {name:'é¸¡è›‹ä»”',emoji:'ğŸ§‡',cal:350},{name:'ç« é±¼å°ä¸¸å­',emoji:'ğŸ™',cal:380},{name:'ç‚¸åœŸè±†é¥¼',emoji:'ğŸ¥”',cal:320},
    {name:'è„†çš®äº”èŠ±è‚‰',emoji:'ğŸ¥©',cal:550},{name:'ç‚¸ç‰›å¥¶',emoji:'ğŸ¥›',cal:300},{name:'ç‚¸æ±¤åœ†',emoji:'âšª',cal:270},
    {name:'ç‹¼ç‰™åœŸè±†',emoji:'ğŸ¥”',cal:330},{name:'ç‚¸è—•ç›’',emoji:'ğŸŸ¤',cal:280},{name:'å¤©å¦‡ç½—',emoji:'ğŸ¤',cal:360},
    {name:'ç”œç”œåœˆ',emoji:'ğŸ©',cal:350},{name:'å‰äº‹æœ',emoji:'ğŸ¥–',cal:320},{name:'éº»å›¢',emoji:'ğŸŸ¡',cal:300},
    {name:'ç‚¸é¦’å¤´ç‰‡',emoji:'ğŸ',cal:280},{name:'èŠå£«æ£’',emoji:'ğŸ§€',cal:340},{name:'çƒ­ç‹—æ£’',emoji:'ğŸŒ­',cal:400},
    {name:'è›‹æŒ',emoji:'ğŸ¥§',cal:280},{name:'å¯ä¹é¥¼',emoji:'ğŸŸ¤',cal:290},{name:'ç‚¸è±†è…',emoji:'ğŸŸ«',cal:220},
    {name:'ç‚¸èŠ±ç”Ÿç±³',emoji:'ğŸ¥œ',cal:380},{name:'æ¤’ç›æ’æ¡',emoji:'ğŸ¥©',cal:420},{name:'ç‚¸èš•è±†',emoji:'ğŸ«˜',cal:300},
    {name:'é”…å·´',emoji:'ğŸ˜',cal:350},{name:'ç‚¸ä¸¸å­',emoji:'ğŸ§†',cal:320},{name:'æ²¹æ¡',emoji:'ğŸ¥–',cal:310},
    {name:'éº»èŠ±',emoji:'ğŸ”€',cal:370},{name:'é¦“å­',emoji:'ğŸŸ¤',cal:340},{name:'ç‚¸å†°æ·‡æ·‹',emoji:'ğŸ¦',cal:450},
    {name:'èŠå£«å¹´ç³•',emoji:'ğŸ§€',cal:380},{name:'ç´«è–¯çƒ',emoji:'ğŸŸ£',cal:260},{name:'æ²¹ç‚¸ç³•',emoji:'ğŸŸ¡',cal:330},
    {name:'é©´æ‰“æ»š',emoji:'ğŸŸ¤',cal:300},{name:'ç‚¸é…±é¢é…¥',emoji:'ğŸœ',cal:350},{name:'å’–å–±è§’',emoji:'ğŸ”º',cal:310},
    {name:'ç‚¸ç³–ç³•',emoji:'ğŸŸ ',cal:340},{name:'è™¾é¥¼',emoji:'ğŸ¦',cal:300},
  ],
  'ğŸ”¥ çƒ§çƒ¤æ’¸ä¸²': [
    {name:'çƒ¤ç¾Šè‚‰ä¸²',emoji:'ğŸ¢',cal:200},{name:'çƒ¤ç‰›è‚‰ä¸²',emoji:'ğŸ¥©',cal:220},{name:'çƒ¤é¸¡ç¿…',emoji:'ğŸ—',cal:280},
    {name:'çƒ¤äº”èŠ±è‚‰',emoji:'ğŸ¥“',cal:350},{name:'çƒ¤ç”Ÿèš',emoji:'ğŸ¦ª',cal:150},{name:'çƒ¤éŸ­èœ',emoji:'ğŸŒ¿',cal:80},
    {name:'çƒ¤èŒ„å­',emoji:'ğŸ†',cal:180},{name:'çƒ¤ç‰ç±³',emoji:'ğŸŒ½',cal:160},{name:'çƒ¤é‡‘é’ˆè‡',emoji:'ğŸ„',cal:100},
    {name:'çƒ¤é±¼',emoji:'ğŸŸ',cal:300},{name:'çƒ¤è’œ',emoji:'ğŸ§„',cal:60},{name:'çƒ¤é¦’å¤´',emoji:'ğŸ',cal:200},
    {name:'çƒ¤é¢ç­‹',emoji:'ğŸŸ¤',cal:150},{name:'çƒ¤åœŸè±†',emoji:'ğŸ¥”',cal:140},{name:'çƒ¤é¸¡å¿ƒ',emoji:'â¤ï¸',cal:180},
    {name:'çƒ¤æ’éª¨',emoji:'ğŸ–',cal:400},{name:'çƒ¤æ‰‡è´',emoji:'ğŸš',cal:120},{name:'çƒ¤ç§‹åˆ€é±¼',emoji:'ğŸŸ',cal:250},
    {name:'çƒ¤é¸¡èƒ—',emoji:'ğŸŸ¤',cal:160},{name:'çƒ¤è±†çš®',emoji:'ğŸŸ¨',cal:130},{name:'çƒ¤é¸¡çˆª',emoji:'ğŸ”',cal:200},
    {name:'çƒ¤çŒªè¹„',emoji:'ğŸ·',cal:380},{name:'çƒ¤è…°å­',emoji:'ğŸ«˜',cal:220},{name:'çƒ¤è„†éª¨',emoji:'ğŸ¦´',cal:190},
    {name:'çƒ¤å¤§è™¾',emoji:'ğŸ¦',cal:170},{name:'é”¡çº¸èŠ±ç”²',emoji:'ğŸš',cal:130},{name:'çƒ¤è‚¥ç‰›',emoji:'ğŸ¥©',cal:320},
    {name:'çƒ¤ç¾Šæ’',emoji:'ğŸ–',cal:400},{name:'çƒ¤çŒªé¢ˆè‚‰',emoji:'ğŸ¥©',cal:280},{name:'çƒ¤é¸¡çš®',emoji:'ğŸ”',cal:250},
    {name:'çƒ¤åŸ¹æ ¹å·',emoji:'ğŸ¥“',cal:300},{name:'çƒ¤é¦™è‡',emoji:'ğŸ„',cal:70},{name:'çƒ¤è¾£æ¤’',emoji:'ğŸŒ¶ï¸',cal:50},
    {name:'çƒ¤èœœè–¯',emoji:'ğŸ ',cal:180},{name:'çƒ¤å¹´ç³•',emoji:'ğŸŸ«',cal:200},{name:'çƒ¤è±†è…',emoji:'ğŸŸ¨',cal:120},
    {name:'çƒ¤ç‰›èˆŒ',emoji:'ğŸ‘…',cal:240},{name:'çƒ¤çŒªè‚',emoji:'ğŸŸ¤',cal:200},{name:'çƒ¤é¸­è„–',emoji:'ğŸ¦†',cal:220},
    {name:'çƒ¤é±¿é±¼',emoji:'ğŸ¦‘',cal:180},{name:'çƒ¤å‡¤çˆª',emoji:'ğŸ”',cal:210},{name:'çƒ¤ç”œæ¤’',emoji:'ğŸ«‘',cal:40},
    {name:'é“æ¿è±†è…',emoji:'ğŸŸ«',cal:200},{name:'çƒ¤å†·é¢',emoji:'ğŸœ',cal:350},{name:'çƒ¤è‚‰è‚ ',emoji:'ğŸŒ­',cal:280},
    {name:'çƒ¤ç‰›è›™',emoji:'ğŸ¸',cal:200},{name:'çƒ¤ç”°èº',emoji:'ğŸŒ',cal:120},{name:'çƒ¤çŒªå°¾å·´',emoji:'ğŸ·',cal:250},
    {name:'çƒ¤å°é¾™è™¾',emoji:'ğŸ¦',cal:200},{name:'çƒ¤è›å­',emoji:'ğŸš',cal:100},
  ],
  'ğŸœ å¤œå®µä¸»é£Ÿ': [
    {name:'éº»è¾£çƒ«',emoji:'ğŸ²',cal:600},{name:'èºè›³ç²‰',emoji:'ğŸœ',cal:500},{name:'é…¸è¾£ç²‰',emoji:'ğŸœ',cal:450},
    {name:'çƒ­å¹²é¢',emoji:'ğŸ',cal:400},{name:'æ‹Œé¢',emoji:'ğŸ',cal:380},{name:'ç‚’é¥­',emoji:'ğŸš',cal:500},
    {name:'ç‚’å¹´ç³•',emoji:'ğŸ¡',cal:420},{name:'æ–¹ä¾¿é¢',emoji:'ğŸœ',cal:480},{name:'æ‹‰é¢',emoji:'ğŸœ',cal:520},
    {name:'é¦„é¥¨',emoji:'ğŸ¥Ÿ',cal:350},{name:'æ°´é¥º',emoji:'ğŸ¥Ÿ',cal:400},{name:'ç…é¥º',emoji:'ğŸ¥Ÿ',cal:450},
    {name:'å°ç¬¼åŒ…',emoji:'ğŸ§ƒ',cal:380},{name:'ç”Ÿç…åŒ…',emoji:'ğŸŸ¡',cal:420},{name:'é”…è´´',emoji:'ğŸ¥Ÿ',cal:400},
    {name:'ç ‚é”…ç²¥',emoji:'ğŸš',cal:300},{name:'çš®è›‹ç˜¦è‚‰ç²¥',emoji:'ğŸ¥£',cal:280},{name:'çº¢çƒ§ç‰›è‚‰é¢',emoji:'ğŸœ',cal:550},
    {name:'è‚¥è‚ ç²‰',emoji:'ğŸœ',cal:480},{name:'ç±³çº¿',emoji:'ğŸœ',cal:400},{name:'åˆ€å‰Šé¢',emoji:'ğŸ',cal:450},
    {name:'å‡‰çš®',emoji:'ğŸ½ï¸',cal:350},{name:'è‚‰å¤¹é¦',emoji:'ğŸ«“',cal:480},{name:'æ‰‹æŠ“é¥¼',emoji:'ğŸ«“',cal:420},
    {name:'è‘±æ²¹é¥¼',emoji:'ğŸ«“',cal:380},{name:'é¸¡è›‹çŒé¥¼',emoji:'ğŸ¥š',cal:400},{name:'ç…é¥¼æœå­',emoji:'ğŸ«“',cal:450},
    {name:'çƒ¤å†·é¢',emoji:'ğŸœ',cal:350},{name:'ç‚’æ²³ç²‰',emoji:'ğŸ',cal:420},{name:'æ‹…æ‹…é¢',emoji:'ğŸœ',cal:460},
    {name:'é‡åº†å°é¢',emoji:'ğŸŒ¶ï¸',cal:440},{name:'æ²¹æ³¼é¢',emoji:'ğŸ',cal:480},{name:'è‡Šå­é¢',emoji:'ğŸœ',cal:430},
    {name:'é˜³æ˜¥é¢',emoji:'ğŸœ',cal:300},{name:'ç‚¸é…±é¢',emoji:'ğŸœ',cal:500},{name:'å¤è‚‰é¥­',emoji:'ğŸš',cal:550},
    {name:'é»„ç„–é¸¡',emoji:'ğŸ—',cal:600},{name:'éº»è¾£é¦™é”…',emoji:'ğŸ³',cal:700},{name:'å†’èœ',emoji:'ğŸ¥¬',cal:500},
    {name:'å…³ä¸œç…®',emoji:'ğŸ¢',cal:350},{name:'é“æ¿ç‚’é¥­',emoji:'ğŸš',cal:520},{name:'è›‹ç‚’é¥­',emoji:'ğŸ¥š',cal:450},
    {name:'æ‰¬å·ç‚’é¥­',emoji:'ğŸš',cal:500},{name:'å‰çƒ§é¥­',emoji:'ğŸ–',cal:550},{name:'çŒªè„šé¥­',emoji:'ğŸ·',cal:600},
    {name:'é¸­è¡€ç²‰ä¸æ±¤',emoji:'ğŸ¦†',cal:380},{name:'æ’éª¨è—•æ±¤',emoji:'ğŸ–',cal:400},{name:'é…¸èœé±¼',emoji:'ğŸŸ',cal:500},
    {name:'æ°´ç…®è‚‰ç‰‡',emoji:'ğŸŒ¶ï¸',cal:650},{name:'å®«ä¿é¸¡ä¸',emoji:'ğŸ—',cal:480},
  ],
  'ğŸ° ç”œå“è›‹ç³•': [
    {name:'èŠå£«è›‹ç³•',emoji:'ğŸ°',cal:350},{name:'ææ‹‰ç±³è‹',emoji:'ğŸ°',cal:400},{name:'é©¬å¡é¾™',emoji:'ğŸŸ£',cal:180},
    {name:'æ³¡èŠ™',emoji:'ğŸŸ¡',cal:250},{name:'æ…•æ–¯è›‹ç³•',emoji:'ğŸ‚',cal:320},{name:'å·§å…‹åŠ›è›‹ç³•',emoji:'ğŸ«',cal:450},
    {name:'å¥¶æ²¹è›‹ç³•',emoji:'ğŸ‚',cal:380},{name:'åƒå±‚è›‹ç³•',emoji:'ğŸ°',cal:420},{name:'èˆ’èŠ™è•¾',emoji:'ğŸ®',cal:300},
    {name:'ç­æˆŸ',emoji:'ğŸ¥',cal:280},{name:'å¯ä¸½é¥¼',emoji:'ğŸ¥',cal:350},{name:'åå¤«é¥¼',emoji:'ğŸ§‡',cal:360},
    {name:'çº¢ä¸ç»’è›‹ç³•',emoji:'â¤ï¸',cal:400},{name:'å¸ƒæœ—å°¼',emoji:'ğŸŸ¤',cal:380},{name:'æ›²å¥‡é¥¼å¹²',emoji:'ğŸª',cal:250},
    {name:'å†°æ·‡æ·‹',emoji:'ğŸ¦',cal:300},{name:'é›ªç³•',emoji:'ğŸ¨',cal:280},{name:'éº»è–¯',emoji:'ğŸŸ¢',cal:200},
    {name:'é“œé”£çƒ§',emoji:'ğŸ¥',cal:250},{name:'è›‹é»„é…¥',emoji:'ğŸŸ¡',cal:300},{name:'æœˆé¥¼',emoji:'ğŸ¥®',cal:420},
    {name:'ç»¿è±†ç³•',emoji:'ğŸ’š',cal:200},{name:'æ¡ƒé…¥',emoji:'ğŸŸ¤',cal:280},{name:'æä»é¥¼',emoji:'ğŸŸ¡',cal:260},
    {name:'ç‰›è½§ç³–',emoji:'ğŸ¬',cal:180},{name:'é›ªèŠ±é…¥',emoji:'â„ï¸',cal:220},{name:'è”“è¶Šè“é¥¼å¹²',emoji:'ğŸ”´',cal:240},
    {name:'ç‘å£«å·',emoji:'ğŸŸ¤',cal:350},{name:'é»‘æ£®æ—è›‹ç³•',emoji:'ğŸ’',cal:400},{name:'æŠ¹èŒ¶è›‹ç³•',emoji:'ğŸµ',cal:340},
    {name:'å¥¶æ²¹æ³¡èŠ™',emoji:'ğŸŸ¡',cal:300},{name:'ç„¦ç³–å¸ƒä¸',emoji:'ğŸ®',cal:250},{name:'èŠ’æœè¥¿ç±³éœ²',emoji:'ğŸ¥­',cal:280},
    {name:'çº¢è±†æ±¤åœ†',emoji:'ğŸ”´',cal:300},{name:'é…’é…¿åœ†å­',emoji:'âšª',cal:260},{name:'è±†èŠ±',emoji:'ğŸŸ¡',cal:150},
    {name:'æ¤°æ±é»‘ç³¯ç±³',emoji:'ğŸ¥¥',cal:320},{name:'èŠ‹åœ†ç”œæ±¤',emoji:'ğŸŸ£',cal:280},
    {name:'ç³–è‘«èŠ¦',emoji:'ğŸ”´',cal:220},{name:'æ¡‚èŠ±ç³•',emoji:'ğŸŒ¸',cal:200},{name:'é¾Ÿè‹“è†',emoji:'ğŸ–¤',cal:120},
    {name:'æœ¨ç³ è›‹ç³•',emoji:'ğŸŸ¤',cal:380},{name:'æ‹¿ç ´ä»‘',emoji:'ğŸ°',cal:420},{name:'ç”Ÿå·§å…‹åŠ›',emoji:'ğŸ«',cal:350},
    {name:'ç„¦ç³–é¥¼å¹²',emoji:'ğŸª',cal:260},{name:'è‰è“å¤§ç¦',emoji:'ğŸ“',cal:200},{name:'å·´æ–¯å…‹è›‹ç³•',emoji:'ğŸ°',cal:400},
    {name:'è‚‰æ¾å°è´',emoji:'ğŸŸ¡',cal:300},{name:'èœœè±†é¢åŒ…',emoji:'ğŸ',cal:320},
  ],
  'ğŸ¿ é›¶é£Ÿè–¯ç‰‡': [
    {name:'è–¯ç‰‡',emoji:'ğŸ¿',cal:550},{name:'è¾£æ¡',emoji:'ğŸŒ¶ï¸',cal:400},{name:'é¸¡çˆª',emoji:'ğŸ”',cal:300},
    {name:'é¸­è„–',emoji:'ğŸ¦†',cal:280},{name:'çŒªè¹„',emoji:'ğŸ·',cal:350},{name:'ç‰›è‚‰å¹²',emoji:'ğŸ¥©',cal:320},
    {name:'é±¼è±†è…',emoji:'ğŸŸ',cal:250},{name:'è±†å¹²',emoji:'ğŸŸ«',cal:200},{name:'æµ·è‹”',emoji:'ğŸŸ¢',cal:100},
    {name:'ç“œå­',emoji:'ğŸŒ»',cal:300},{name:'èŠ±ç”Ÿ',emoji:'ğŸ¥œ',cal:350},{name:'å¼€å¿ƒæœ',emoji:'ğŸŸ¢',cal:320},
    {name:'è…°æœ',emoji:'ğŸŸ¡',cal:350},{name:'æ ¸æ¡ƒ',emoji:'ğŸ§ ',cal:380},{name:'è¯æ¢…',emoji:'ğŸŸ¤',cal:120},
    {name:'æœå†»',emoji:'ğŸŸ£',cal:100},{name:'å·§å…‹åŠ›',emoji:'ğŸ«',cal:550},{name:'ç³–æœ',emoji:'ğŸ¬',cal:400},
    {name:'é¥¼å¹²',emoji:'ğŸª',cal:450},{name:'å¨åŒ–',emoji:'ğŸŸ«',cal:480},{name:'è›‹å·',emoji:'ğŸŸ¡',cal:420},
    {name:'å¥¶ç‰‡',emoji:'âšª',cal:200},{name:'å±±æ¥‚ç‰‡',emoji:'ğŸ”´',cal:180},{name:'æœä¸¹çš®',emoji:'ğŸŸ¤',cal:200},
    {name:'æ£‰èŠ±ç³–',emoji:'â˜ï¸',cal:300},{name:'è·³è·³ç³–',emoji:'ğŸ’¥',cal:150},{name:'å£é¦™ç³–',emoji:'ğŸ«§',cal:50},
    {name:'è™¾æ¡',emoji:'ğŸ¦',cal:450},{name:'æ—ºä»”å°é¦’å¤´',emoji:'ğŸŸ¡',cal:380},{name:'è›‹é»„æ´¾',emoji:'ğŸŸ¡',cal:350},
    {name:'æ²™çªç›',emoji:'ğŸŸ¤',cal:400},{name:'é›ªé¥¼',emoji:'âšª',cal:350},
    {name:'ä»™è´',emoji:'ğŸ˜',cal:320},{name:'é”…å·´',emoji:'ğŸŸ¤',cal:380},{name:'é±¼ç‰‡',emoji:'ğŸŸ',cal:250},
    {name:'çŒªè‚‰è„¯',emoji:'ğŸ¥“',cal:350},{name:'å‡¤çˆª',emoji:'ğŸ”',cal:280},{name:'å¤è›‹',emoji:'ğŸ¥š',cal:150},
    {name:'è±†è…å¹²',emoji:'ğŸŸ«',cal:200},{name:'ç´ è‚‰',emoji:'ğŸŒ±',cal:250},{name:'æµ·å¸¦ç»“',emoji:'ğŸŸ¤',cal:80},
    {name:'é­”èŠ‹çˆ½',emoji:'ğŸŸ¢',cal:60},{name:'é…¸è§’ç³•',emoji:'ğŸŸ¤',cal:200},{name:'èŠ’æœå¹²',emoji:'ğŸŸ¡',cal:350},
    {name:'è‘¡è„å¹²',emoji:'ğŸŸ£',cal:300},{name:'çº¢æ£',emoji:'ğŸ”´',cal:280},{name:'è”“è¶Šè“å¹²',emoji:'ğŸ”´',cal:320},
    {name:'æ¤°å­ç‰‡',emoji:'ğŸ¥¥',cal:350},{name:'å±±æ ¸æ¡ƒ',emoji:'ğŸŸ¤',cal:400},
  ],
  'ğŸ• å¤–å–å¤§é¤': [
    {name:'æŠ«è¨',emoji:'ğŸ•',cal:800},{name:'æ±‰å ¡',emoji:'ğŸ”',cal:650},{name:'ç‚¸é¸¡å…¨å®¶æ¡¶',emoji:'ğŸ—',cal:1200},
    {name:'å¯¿å¸æ‹¼ç›˜',emoji:'ğŸ£',cal:500},{name:'å’–å–±é¥­',emoji:'ğŸ›',cal:550},{name:'ç›–æµ‡é¥­',emoji:'ğŸš',cal:600},
    {name:'çƒ¤è‚‰æ‹Œé¥­',emoji:'ğŸ¥©',cal:580},{name:'çŸ³é”…æ‹Œé¥­',emoji:'ğŸš',cal:500},{name:'æ—¥å¼æ‹‰é¢',emoji:'ğŸœ',cal:600},
    {name:'ä¸‰æ˜æ²»',emoji:'ğŸ¥ª',cal:400},{name:'å¢¨è¥¿å“¥å·',emoji:'ğŸŒ¯',cal:500},{name:'æ„å¤§åˆ©é¢',emoji:'ğŸ',cal:550},
    {name:'ç„—é¥­',emoji:'ğŸš',cal:650},{name:'ç‚¸çŒªæ’é¥­',emoji:'ğŸ–',cal:700},{name:'é³—é±¼é¥­',emoji:'ğŸŸ',cal:600},
    {name:'é“æ¿çƒ§',emoji:'ğŸ¥©',cal:650},{name:'éŸ©å¼ç‚¸é¸¡',emoji:'ğŸ—',cal:800},{name:'çƒ¤é¸­',emoji:'ğŸ¦†',cal:750},
    {name:'å°é¾™è™¾',emoji:'ğŸ¦',cal:600},{name:'ç«é”…',emoji:'ğŸ²',cal:1000},{name:'çƒ¤å…¨é±¼',emoji:'ğŸŸ',cal:550},
    {name:'çº¢çƒ§è‚‰',emoji:'ğŸ¥©',cal:700},{name:'ç³–é†‹æ’éª¨',emoji:'ğŸ–',cal:650},{name:'å›é”…è‚‰',emoji:'ğŸ¥“',cal:600},
    {name:'é±¼é¦™è‚‰ä¸',emoji:'ğŸŸ',cal:480},{name:'éº»å©†è±†è…',emoji:'ğŸŒ¶ï¸',cal:350},{name:'å¹²é”…èŠ±èœ',emoji:'ğŸ¥¦',cal:300},
    {name:'æ¤’ç›è™¾',emoji:'ğŸ¦',cal:400},{name:'è’œè“‰é¾™è™¾',emoji:'ğŸ¦',cal:450},{name:'ç™½åˆ‡é¸¡',emoji:'ğŸ—',cal:350},
    {name:'å£æ°´é¸¡',emoji:'ğŸ”',cal:400},{name:'å¤«å¦»è‚ºç‰‡',emoji:'ğŸ¥©',cal:380},{name:'æ¯›è¡€æ—º',emoji:'ğŸŒ¶ï¸',cal:550},
    {name:'æ°´ç…®é±¼',emoji:'ğŸŸ',cal:600},{name:'çº¢çƒ§é±¼',emoji:'ğŸŸ',cal:450},{name:'æ¸…è’¸é²ˆé±¼',emoji:'ğŸŸ',cal:250},
    {name:'è’œè“‰ç²‰ä¸è™¾',emoji:'ğŸ¦',cal:350},{name:'ç›ç„—é¸¡',emoji:'ğŸ—',cal:400},{name:'å«èŠ±é¸¡',emoji:'ğŸ”',cal:500},
    {name:'ä¸œå¡è‚‰',emoji:'ğŸ¥©',cal:700},{name:'æ¢…èœæ‰£è‚‰',emoji:'ğŸ¥¬',cal:650},{name:'çº¢çƒ§çŒªè¹„',emoji:'ğŸ·',cal:600},
    {name:'é“æ¿é±¿é±¼',emoji:'ğŸ¦‘',cal:350},{name:'é¦™è¾£èŸ¹',emoji:'ğŸ¦€',cal:500},{name:'æ¤’ç›çš®çš®è™¾',emoji:'ğŸ¦',cal:400},
    {name:'è’œè“‰æ‰‡è´',emoji:'ğŸš',cal:200},{name:'è‘±å§œç‚’èŸ¹',emoji:'ğŸ¦€',cal:450},{name:'æ¸…è’¸å¤§é—¸èŸ¹',emoji:'ğŸ¦€',cal:180},
    {name:'å‰æ¤’é±¼å¤´',emoji:'ğŸŸ',cal:400},{name:'é…±éª¨æ¶',emoji:'ğŸ¦´',cal:500},
  ],
};

// é˜¶æ®µå®šä¹‰ï¼ˆè¶Šå°‘æ³¢æ•°æ”¾å¼ƒ=æ„å¿—åŠ›è¶Šå¼ºï¼‰
const PHASES = [
  { name: 'å¿ƒç†é˜²çº¿æœŸ', range: [1, 3], color: 'var(--phase1-color)', bg: 'var(--phase1-bg)', emoji: 'ğŸ›¡ï¸', desc: 'è¯†ç ´å‡æ€§é¥¥é¥¿', dotColor: '#60A5FA' },
  { name: 'å¤šå·´èƒºé™·é˜±æœŸ', range: [4, 7], color: 'var(--phase2-color)', bg: 'var(--phase2-bg)', emoji: 'ğŸ§ ', desc: 'å¤šå·´èƒºåœ¨æ¬ºéª—ä½ ', dotColor: '#FBBF24' },
  { name: 'è§†è§‰å†²å‡»æœŸ', range: [8, 12], color: 'var(--phase3-color)', bg: 'var(--phase3-bg)', emoji: 'ğŸ‘ï¸', desc: 'ç›´é¢æ®‹é…·çœŸç›¸', dotColor: '#F87171' },
  { name: 'è‡ªæˆ‘æ€€ç–‘æœŸ', range: [13, 17], color: 'var(--phase4-color)', bg: 'var(--phase4-bg)', emoji: 'ğŸ˜°', desc: 'æœ€éš¾ç†¬çš„æ—¶åˆ»', dotColor: '#A855F7' },
  { name: 'é»æ˜å‰çš„é»‘æš—', range: [18, 20], color: 'var(--phase5-color)', bg: 'var(--phase5-bg)', emoji: 'ğŸŒ…', desc: 'é»æ˜å°±åœ¨å‰æ–¹', dotColor: '#34D399' },
];

// æ¯’èˆŒæ¨¡å¼æ–‡æ¡ˆ
const SAVAGE_LINES = [
  {scene:'ğŸ·',curse:'åƒäº†è¿™å£...',text:'ä½ çš„è‚šå­æ­£åœ¨é»˜é»˜è®°è´¦ï¼Œæ¯ä¸€å£éƒ½æ˜¯ä¸€ç¬”è¿˜ä¸æ¸…çš„"è„‚è‚ªè´·"ã€‚'},
  {scene:'ğŸ’€',curse:'è¿™å£ä¸‹å»...',text:'åˆ«äººåœ¨ç ”ç©¶ç©¿æ­ï¼Œä½ åœ¨ç ”ç©¶å“ªå®¶å¤§ç è£…åŒ…é‚®ã€‚'},
  {scene:'ğŸ˜',curse:'å’¬ä¸‹å»çš„ç¬é—´...',text:'ä½ ä½“é‡ç§¤ä¸Šçš„æ•°å­—æ­£åœ¨å‡†å¤‡å¼€åº†åŠŸå®´ã€‚'},
  {scene:'ğŸ˜±',curse:'åä¸‹å»ä¹‹å...',text:'æ˜æ—©çš„é•œå­ä¼šæ›¿ä½ è®°ä½ä»Šæ™šæ‰€æœ‰çš„æ”¾çºµâ€”â€”è„¸è‚¿å¾—åƒå‘é¢é¦’å¤´ã€‚'},
  {scene:'ğŸ¤¡',curse:'å½“ä½ é€‰æ‹©åƒ...',text:'ä½ ä¸æ˜¯é¥¿ï¼Œä½ åªæ˜¯å˜´å¯‚å¯ã€‚å¯ä½ çš„è£¤è…°å¸¦å¯ä¸è¿™ä¹ˆæƒ³ã€‚'},
  {scene:'ğŸ’”',curse:'æ¯ä¸€å£éƒ½åœ¨è¯´...',text:'é‚£æ¡åˆšä¹°çš„è£™å­æ­£åœ¨è¡£æŸœé‡Œå“­æ³£ï¼Œå› ä¸ºå®ƒçŸ¥é“ä½ ç©¿ä¸ä¸Šäº†ã€‚'},
  {scene:'ğŸª',curse:'ç…§ç…§é•œå­...',text:'ä½ ç¡®å®šè¦ç»™ä½ åŒä¸‹å·´å†åŠ ä¸€å±‚å—ï¼Ÿå®ƒå·²ç»å¤Ÿè¾›è‹¦äº†ã€‚'},
  {scene:'ğŸ’¸',curse:'ç®—ç®—è´¦...',text:'è¿™äº›é’±èŠ±åœ¨å¥èº«å¡ä¸Šï¼Œä½ ç°åœ¨å·²ç»æ˜¯å¥³ç¥äº†ã€‚å¯ä½ åè¦æŠ•èµ„è„‚è‚ªã€‚'},
  {scene:'ğŸŒ',curse:'åƒå®Œä¹‹å...',text:'æ˜å¤©çš„ä½ ä¼šåƒåªèœ—ç‰›ä¸€æ ·æ²‰é‡åœ°çˆ¬èµ·æ¥ï¼Œåæ‚”ä»Šæ™šçš„æ¯ä¸€å£ã€‚'},
  {scene:'ğŸ¤¢',curse:'å’€åš¼çš„æ—¶å€™...',text:'é‚£é”…æ²¹åå¤ç‚¸äº†å‡ åéï¼Œè‡ªç”±åŸºçš„ç‹‚æ¬¢ï¼Œæ˜¯ä½ çš®è‚¤ç²—ç³™çš„åŠ é€Ÿå™¨ã€‚'},
  {scene:'ğŸ“',curse:'é‡é‡è…°å›´...',text:'ä½ çš„è…°å›´æ¯å¢åŠ 1å˜ç±³ï¼Œå¯¿å‘½å°±ç¼©çŸ­ä¸€ç‚¹ã€‚è¿™å£å€¼å—ï¼Ÿ'},
  {scene:'ğŸ‹ï¸',curse:'åƒäº†è¿™é¡¿...',text:'ä½ å¾—åœ¨è·‘æ­¥æœºä¸Šè·‘ä¸¤ä¸ªå°æ—¶æ‰èƒ½è¿˜æ¸…ã€‚ä¸¤ä¸ªå°æ—¶å•Šå§å¦¹ï¼'},
  {scene:'ğŸ˜¤',curse:'å½“ä½ ä¸¾èµ·ç­·å­...',text:'ä½ å‰ä»»æ­£åœ¨æœ‹å‹åœˆç§€æ–°å¥³å‹çš„é©¬ç”²çº¿ï¼Œä½ ç¡®å®šè¦ç»§ç»­åƒï¼Ÿ'},
  {scene:'ğŸª',curse:'é€‰æ‹©æ”¾çºµ...',text:'æ·±å¤œåƒä¸œè¥¿ï¼šä½ çš„èƒƒåœ¨åŠ ç­ï¼Œä½ çš„è„¸åœ¨è†¨èƒ€ï¼Œåªæœ‰è„‚è‚ªåœ¨å¼€æ´¾å¯¹ã€‚'},
  {scene:'ğŸ« ',curse:'åƒå®Œçš„ä½ ...',text:'åˆ«éª—è‡ªå·±"å°±åƒä¸€å£"ã€‚ä½ çš„"ä¸€å£"èƒ½åæ‰ä¸€æ•´ä»½å…¨å®¶æ¡¶ã€‚'},
  {scene:'ğŸ‘—',curse:'è¯•è¡£é—´è­¦å‘Š...',text:'å¤å¤©å¿«æ¥äº†ï¼Œä½ çš„è‚‰å·²ç»å‡†å¤‡å¥½ä»è£™å­é‡Œæº¢å‡ºæ¥æ‰“æ‹›å‘¼äº†ã€‚'},
  {scene:'ğŸ„',curse:'è¿™é¡¿é¥­çš„ä»£ä»·...',text:'åƒå§ï¼Œåæ­£æ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©â€”â€”ä¸€ä¸ªæ›´èƒ–çš„ä½ è¿æ¥çš„æ–°ä¸€å¤©ã€‚'},
  {scene:'ğŸ¯',curse:'æƒ³æƒ³ä½ çš„ç›®æ ‡...',text:'99æ–¤ï¼ŸæŒ‰ä½ ç°åœ¨è¿™ä¸ªåƒæ³•ï¼Œ199æ–¤è¿˜å·®ä¸å¤šã€‚'},
  {scene:'ğŸ”¥',curse:'è„‚è‚ªåœ¨ç‡ƒçƒ§ï¼Ÿ...',text:'ä¸å¯¹ï¼Œæ˜¯ä½ çš„æ„å¿—åŠ›åœ¨ç‡ƒçƒ§æ®†å°½ã€‚ä½ å°±è¿™ç‚¹å‡ºæ¯ï¼Ÿ'},
  {scene:'ğŸ‘»',curse:'æ·±å¤œçš„ä½ ...',text:'ä½ ä»¥ä¸ºåƒå®Œå°±å®Œäº†ï¼Ÿä¸ï¼Œå†…ç–šä¼šåƒé¬¼ä¸€æ ·ç¼ ç€ä½ åˆ°å¤©äº®ã€‚'},
];

// å¥³ç¥æ¨¡å¼æ–‡æ¡ˆ
const GODDESS_LINES = [
  {scene:'ğŸ‘¸',curse:'äº²çˆ±çš„...',text:'æ”¾ä¸‹å®ƒï¼Œä½ å€¼å¾—æ›´å¥½çš„ã€‚æ˜å¤©é†’æ¥ï¼Œä½ ä¼šæ„Ÿè°¢ç°åœ¨çš„è‡ªå·±ã€‚'},
  {scene:'ğŸŒŸ',curse:'ä½ çŸ¥é“å—...',text:'çœŸæ­£çš„ç¾ä¸½ä»è‡ªå¾‹å¼€å§‹ã€‚ä½ å·²ç»å¾ˆæ£’äº†ï¼Œå†åšæŒä¸€ä¸‹å°±å¥½ã€‚'},
  {scene:'ğŸ¦‹',curse:'æƒ³è±¡ä¸€ä¸‹...',text:'æ˜å¤©ç©¿ä¸Šé‚£æ¡æœ€çˆ±çš„è£™å­ï¼Œè‡ªä¿¡èµ°è¿‡è¡—å¤´çš„ä½ ï¼Œå¤šç¾å•Šã€‚'},
  {scene:'ğŸ’ª',curse:'ä½ æ¯”ä½ æƒ³è±¡çš„...',text:'æ›´åŠ å¼ºå¤§ã€‚è¿™ç‚¹å°å°çš„é¥¥é¥¿æ„Ÿï¼Œæ ¹æœ¬ä¸æ˜¯ä½ çš„å¯¹æ‰‹ã€‚'},
  {scene:'ğŸŒ¸',curse:'æ¯ä¸€æ¬¡å¿ä½...',text:'éƒ½æ˜¯åœ¨ä¸ºæœªæ¥çš„è‡ªå·±å­˜ä¸€ç¬”"ç¾ä¸½åŸºé‡‘"ã€‚ä½ å€¼å¾—è¢«æŠ•èµ„ã€‚'},
  {scene:'âœ¨',curse:'é—­ä¸Šçœ¼ç›...',text:'æƒ³è±¡é•œå­é‡Œçº¿æ¡ä¼˜ç¾çš„è‡ªå·±ï¼Œé‚£ç§è‡ªä¿¡çš„å…‰èŠ’ï¼Œæ¯”ä»»ä½•ç¾é£Ÿéƒ½ç¾å‘³ã€‚'},
  {scene:'ğŸŒ™',curse:'æ·±å¤œçš„è¯±æƒ‘...',text:'åªæ˜¯èº«ä½“åœ¨è€ƒéªŒä½ ã€‚å–æ¯æ¸©æ°´ï¼Œåšå‡ ä¸ªæ·±å‘¼å¸ï¼Œä½ å¯ä»¥çš„ã€‚'},
  {scene:'ğŸ’',curse:'ä½ æ˜¯é’»çŸ³...',text:'ä¸éœ€è¦ç”¨é£Ÿç‰©æ¥å¡«è¡¥ä»€ä¹ˆã€‚ä½ æœ¬èº«å°±è¶³å¤Ÿé—ªè€€ã€‚'},
  {scene:'ğŸ€',curse:'æƒ³æƒ³çœ‹...',text:'å…¨å…¬å¸æœ€é£’çš„girlå°±æ˜¯ä½ ã€‚è¿™ç‚¹æ²¹è…»ä¸é…è¿›å…¥ä½ é«˜è´µçš„èƒƒã€‚'},
  {scene:'ğŸŒˆ',curse:'æ¯æ¬¡say no...',text:'ä½ ç¦»ç›®æ ‡å°±æ›´è¿‘ä¸€æ­¥ã€‚99æ–¤çš„ä½ åœ¨ç»ˆç‚¹çº¿ç­‰ä½ ï¼Œåˆ«è®©å¥¹å¤±æœ›ã€‚'},
  {scene:'ğŸ§˜',curse:'æ·±å‘¼å¸...',text:'é£Ÿæ¬²åªæ˜¯ä¸€é˜µé£ï¼Œå‡ åˆ†é’Ÿå°±ä¼šè¿‡å»ã€‚è€Œä½ çš„ç¾ä¸½æ˜¯æ°¸æ’çš„ã€‚'},
  {scene:'ğŸ‘‘',curse:'å¥³ç‹ä¸ä¼š...',text:'åœ¨æ·±å¤œå‘é£Ÿæ¬²ä½å¤´ã€‚ä½ æ˜¯è‡ªå·±äººç”Ÿçš„å¥³ç‹ï¼ŒæŒæ§ä¸€åˆ‡ã€‚'},
  {scene:'ğŸŒº',curse:'çˆ±è‡ªå·±...',text:'ä¸æ˜¯æ”¾çºµè‡ªå·±ï¼Œè€Œæ˜¯ç»™è‡ªå·±æœ€å¥½çš„ã€‚å¥åº·å’Œç¾ä¸½å°±æ˜¯æœ€å¥½çš„ç¤¼ç‰©ã€‚'},
  {scene:'ğŸ’«',curse:'ä½ çŸ¥é“å—...',text:'åšæŒ21å¤©å°±èƒ½å…»æˆä¹ æƒ¯ã€‚ä½ å·²ç»èµ°äº†è¿™ä¹ˆè¿œï¼Œåˆ«å›å¤´ã€‚'},
  {scene:'ğŸ­',curse:'æ­¤åˆ»çš„æ¸´æœ›...',text:'åªæ˜¯å¤§è„‘çš„ä¸€ä¸ªå°æŠŠæˆã€‚çœŸæ­£çš„ä½ ï¼Œæ¯”ä¸€ä»½å®µå¤œå¼ºå¤§ä¸€ä¸‡å€ã€‚'},
  {scene:'ğŸ–ï¸',curse:'æƒ³æƒ³æµ·æ»©...',text:'æƒ³æƒ³æ—…è¡Œæ—¶è‡ªä¿¡ç©¿ä¸Šæ¯”åŸºå°¼çš„è‡ªå·±ã€‚é‚£ä¸ªç”»é¢å€¼å¾—ä½ ä»Šæ™šçš„åšæŒã€‚'},
  {scene:'ğŸŒ»',curse:'ä½ å°±åƒå‘æ—¥è‘µ...',text:'æ°¸è¿œæœç€é˜³å…‰ç”Ÿé•¿ã€‚ä»Šæ™šçš„åšæŒï¼Œæ˜¯æ˜å¤©ç»½æ”¾çš„å…»åˆ†ã€‚'},
  {scene:'ğŸ’',curse:'æœªæ¥çš„ä½ ...',text:'ä¸€å®šä¼šç»™ä»Šæ™šçš„ä½ ä¸€ä¸ªå¤§å¤§çš„æ‹¥æŠ±ï¼Œæ„Ÿè°¢ä½ æ²¡æœ‰æ”¾å¼ƒã€‚'},
  {scene:'ğŸµ',curse:'å¬å¬éŸ³ä¹...',text:'ç”¨æ—‹å¾‹ä»£æ›¿é£Ÿç‰©å¡«æ»¡è¿™ä¸ªå¤œæ™šã€‚çµé­‚é¥±äº†ï¼Œèº«ä½“å°±ä¸ä¼šé¥¿ã€‚'},
  {scene:'ğŸŒ ',curse:'è®¸ä¸ªæ„¿å§...',text:'ä»Šæ™šä¸åƒä¸œè¥¿çš„ä½ ï¼Œæ­£åœ¨å®‡å®™çš„è§è¯ä¸‹å˜å¾—æ›´å¥½ã€‚ä½ å€¼å¾—æ‰€æœ‰ç¾å¥½ã€‚'},
];

// ç›²ç›’å¡ç‰‡
const BLINDBOX_CARDS = [
  {boom:'ğŸ’¥',title:'çµé­‚æš´å‡»ï¼',msg:'ä½ å·²ç»æŒ£æ‰äº†è¿™ä¹ˆä¹…ï¼Œä½ çš„è„‚è‚ªæ­£åœ¨ç‘Ÿç‘Ÿå‘æŠ–ï¼',badge:'ã€Œé’¢é“æ„å¿—ã€',color:'var(--red)'},
  {boom:'ğŸ†',title:'æ„å¿—åŠ›çˆ†è¡¨ï¼',msg:'èƒ½åšæŒåˆ°è¿™é‡Œçš„äººåªæœ‰1%ï¼ä½ å°±æ˜¯é‚£ä¸ªä¼ è¯´ï¼',badge:'ã€Œä¸‡ä¸­æ— ä¸€ã€',color:'var(--purple)'},
  {boom:'âš¡',title:'è­¦æŠ¥ï¼è­¦æŠ¥ï¼',msg:'ä½ çš„é£Ÿæ¬²æ­£åœ¨å‘å‡ºæœ€åçš„å“€åšï¼Œå†åšæŒä¸€ä¸‹å®ƒå°±æŠ•é™äº†ï¼',badge:'ã€Œé£Ÿæ¬²ç»ˆç»“è€…ã€',color:'var(--gold)'},
  {boom:'ğŸŒ‹',title:'ç«å±±çˆ†å‘ï¼',msg:'ä½ çš„å°å®‡å®™æ­£åœ¨ç‡ƒçƒ§è„‚è‚ªï¼è¿™è‚¡åŠ›é‡ä¸å¯é˜»æŒ¡ï¼',badge:'ã€Œè„‚è‚ªç²‰ç¢æœºã€',color:'var(--pink)'},
  {boom:'ğŸ‡',title:'å¥‡è¿¹æ—¶åˆ»ï¼',msg:'æ¯ä¸€ç§’çš„åšæŒéƒ½æ˜¯å¥‡è¿¹ã€‚ä½ æ­£åœ¨åˆ›é€ å±äºè‡ªå·±çš„ä¼ è¯´ï¼',badge:'ã€Œå¥‡è¿¹åˆ›é€ è€…ã€',color:'var(--green)'},
  {boom:'ğŸ’«',title:'å®‡å®™çº§è®¤è¯ï¼',msg:'å…¨å®‡å®™æœ€æœ‰æ„å¿—åŠ›çš„å¥³å­©å°±æ˜¯ä½ ï¼æ²¡æœ‰ä¹‹ä¸€ï¼',badge:'ã€Œå®‡å®™å¥³ç¥ã€',color:'var(--purple-light)'},
  {boom:'ğŸ”®',title:'å‘½è¿çš„é€‰æ‹©ï¼',msg:'æ”¾å¼ƒåƒ=å˜ç¾+å˜ç˜¦+è‡ªä¿¡ã€‚åƒ=åæ‚”+é•¿è‚‰+å¤±çœ ã€‚ä½ é€‰å“ªä¸ªï¼Ÿ',badge:'ã€Œå‘½è¿æŒæ§è€…ã€',color:'var(--blue)'},
  {boom:'ğŸ°',title:'å¹¸è¿ç›²ç›’ï¼',msg:'æ­å–œï¼ä½ è§£é”äº†"ä¸åƒå®µå¤œå…ç½ªé‡‘ç‰Œ"ï¼æ°¸ä¹…æœ‰æ•ˆï¼',badge:'ã€Œå…ç½ªé‡‘ç‰Œã€',color:'var(--gold)'},
];

// å¾½ç« å®šä¹‰
const BADGES = [
  {icon:'ğŸŒŸ',name:'åˆæ¬¡è§‰é†’',cond:'å®Œæˆç¬¬ä¸€æ¬¡é—¯å…³',need:'total',val:1},
  {icon:'âš¡',name:'é—ªç”µå†³æ–­',cond:'åœ¨ç¬¬1æ³¢å°±æ”¾å¼ƒåƒ',need:'wave1',val:1},
  {icon:'ğŸ’ª',name:'é’¢é“æ„å¿—',cond:'åœ¨3æ³¢å†…æ”¾å¼ƒåƒ',need:'early',val:1},
  {icon:'ğŸ”¥',name:'è¿ç»­3å¤©',cond:'è¿ç»­æ‰“å¡3å¤©',need:'streak',val:3},
  {icon:'ğŸ‘‘',name:'ä¸€å‘¨å¥³ç‹',cond:'è¿ç»­æ‰“å¡7å¤©',need:'streak',val:7},
  {icon:'ğŸ’',name:'åŠæœˆä¹‹æ˜Ÿ',cond:'è¿ç»­æ‰“å¡15å¤©',need:'streak',val:15},
  {icon:'ğŸ†',name:'æœˆåº¦å† å†›',cond:'è¿ç»­æ‰“å¡30å¤©',need:'streak',val:30},
  {icon:'ğŸ¯',name:'åæˆ˜åèƒœ',cond:'ç´¯è®¡æŠµæŠ—10æ¬¡',need:'total',val:10},
  {icon:'ğŸŒ¸',name:'æ¨±èŠ±å¥³ç¥',cond:'èŠ‚çœ5000åƒå¡',need:'cal',val:5000},
  {icon:'ğŸ¦‹',name:'ç ´èŒ§æˆè¶',cond:'èŠ‚çœ10000åƒå¡',need:'cal',val:10000},
  {icon:'ğŸŒˆ',name:'ç™¾æˆ˜ç™¾èƒœ',cond:'ç´¯è®¡æŠµæŠ—100æ¬¡',need:'total',val:100},
  {icon:'ğŸ‰',name:'å± é¾™å‹‡å£«',cond:'æŒºè¿‡15æ³¢è¯±æƒ‘',need:'maxwave',val:15},
];

// ==================== çŠ¶æ€ç®¡ç† ====================
let state = {
  selectedFoods: [],
  currentMode: null,
  currentLevel: 1,
  totalCal: 0,
  inBattle: false,
  usedLines: [],
};

let saveData = JSON.parse(localStorage.getItem('slim99_data') || 'null') || {
  totalResists: 0,
  totalCalSaved: 0,
  streakDays: 0,
  lastDate: null,
  badges: [],
  history: [],
  maxWave: 0,
  earlyWins: 0,
  wave1Wins: 0,
};
function save() { localStorage.setItem('slim99_data', JSON.stringify(saveData)); }

// ==================== æ¬¢è¿é¡µ ====================
function createStars() {
  const c = document.getElementById('stars');
  for (let i = 0; i < 40; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const size = Math.random() * 3 + 1;
    s.style.cssText = `width:${size}px;height:${size}px;top:${Math.random()*100}%;left:${Math.random()*100}%;animation-delay:${Math.random()*3}s;`;
    c.appendChild(s);
  }
}
createStars();

function enterApp() {
  document.getElementById('page-welcome').classList.remove('active');
  document.getElementById('page-food').classList.add('active');
  document.getElementById('tabBar').classList.add('visible');
  initFoodPage();
}

// ==================== Tab åˆ‡æ¢ ====================
function switchTab(tab) {
  if (state.inBattle) return;
  document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  document.querySelectorAll('.page').forEach(p => {
    if (p.id !== 'page-welcome' && p.id !== 'page-battle') p.classList.remove('active');
  });
  if (tab === 'food') {
    document.getElementById('page-food').classList.add('active');
  } else if (tab === 'achieve') {
    document.getElementById('page-achieve').classList.add('active');
    renderAchievePage();
  }
}

// ==================== é£Ÿç‰©é€‰æ‹©é¡µ ====================
let currentCat = null;

function initFoodPage() {
  const cats = Object.keys(FOOD_DATA);
  if (!currentCat) currentCat = cats[0];
  const catEl = document.getElementById('foodCats');
  catEl.innerHTML = cats.map(c =>
    `<div class="cat-chip${c === currentCat ? ' active' : ''}" onclick="selectCat(this,'${c}')">${c}</div>`
  ).join('');
  renderFoodGrid();
}

function selectCat(el, cat) {
  currentCat = cat;
  document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  renderFoodGrid();
}

function renderFoodGrid() {
  const foods = FOOD_DATA[currentCat] || [];
  const grid = document.getElementById('foodGrid');
  grid.innerHTML = foods.map(f => {
    const sel = state.selectedFoods.find(s => s.name === f.name);
    return `<div class="food-card${sel ? ' selected' : ''}" onclick="toggleFood('${f.name}',${f.cal},'${f.emoji}',this)">
      <span class="food-emoji">${f.emoji}</span>
      <div class="food-name">${f.name}</div>
      <div class="food-cal">${f.cal}å¡</div>
    </div>`;
  }).join('');
}

function toggleFood(name, cal, emoji, el) {
  const idx = state.selectedFoods.findIndex(f => f.name === name);
  if (idx >= 0) {
    state.selectedFoods.splice(idx, 1);
    el.classList.remove('selected');
  } else {
    state.selectedFoods.push({name, cal, emoji});
    el.classList.add('selected');
    el.classList.add('shake');
    setTimeout(() => el.classList.remove('shake'), 400);
    if (navigator.vibrate) navigator.vibrate(50);
  }
  updateStats();
}

function updateStats() {
  state.totalCal = state.selectedFoods.reduce((s, f) => s + f.cal, 0);
  document.getElementById('totalCal').textContent = state.totalCal;
  document.getElementById('totalRun').textContent = (state.totalCal / 70).toFixed(1);
  const btn = document.getElementById('startBattleBtn');
  btn.disabled = state.selectedFoods.length === 0;
  btn.textContent = state.selectedFoods.length > 0
    ? `å¼€å§‹é—¯å…³ (${state.selectedFoods.length}é¡¹) â†’`
    : 'å¼€å§‹é—¯å…³ â†’';
}

// ==================== æ¨¡å¼é€‰æ‹© ====================
function showModeSelect() {
  document.getElementById('modeOverlay').classList.add('show');
}
function closeModeSelect() {
  document.getElementById('modeOverlay').classList.remove('show');
}

// ==================== é—¯å…³é€»è¾‘ ====================
function startBattle(mode) {
  state.currentMode = mode;
  state.currentLevel = 1;
  state.inBattle = true;
  state.usedLines = [];
  document.getElementById('modeOverlay').classList.remove('show');
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-battle').classList.add('active');
  document.getElementById('tabBar').classList.remove('visible');
  renderPhaseIndicators();
  renderBattleLevel();
}

function getPhase(level) {
  for (const p of PHASES) {
    if (level >= p.range[0] && level <= p.range[1]) return p;
  }
  return PHASES[PHASES.length - 1];
}

function getPhaseIndex(level) {
  for (let i = 0; i < PHASES.length; i++) {
    if (level >= PHASES[i].range[0] && level <= PHASES[i].range[1]) return i;
  }
  return PHASES.length - 1;
}

function renderPhaseIndicators() {
  const el = document.getElementById('phaseIndicators');
  el.innerHTML = PHASES.map((p, i) =>
    `<div class="phase-dot" id="phaseDot${i}" style="background:${p.dotColor}"></div>`
  ).join('');
}

function updatePhaseIndicators(level) {
  const currentIdx = getPhaseIndex(level);
  PHASES.forEach((p, i) => {
    const dot = document.getElementById('phaseDot' + i);
    dot.className = 'phase-dot';
    if (i < currentIdx) dot.classList.add('passed');
    else if (i === currentIdx) dot.classList.add('active');
  });
}

function getRandomLine(level) {
  const lines = state.currentMode === 'savage' ? SAVAGE_LINES : GODDESS_LINES;
  // é¿å…é‡å¤
  const available = lines.filter((_, i) => !state.usedLines.includes(i));
  if (available.length === 0) { state.usedLines = []; return lines[Math.floor(Math.random() * lines.length)]; }
  const idx = Math.floor(Math.random() * available.length);
  const originalIdx = lines.indexOf(available[idx]);
  state.usedLines.push(originalIdx);
  return available[idx];
}

function renderBattleLevel() {
  const level = state.currentLevel;
  const phase = getPhase(level);
  const line = getRandomLine(level);
  const food = state.selectedFoods[Math.floor(Math.random() * state.selectedFoods.length)];

  // é˜¶æ®µæ ‡ç­¾
  const phaseLabel = document.getElementById('phaseLabel');
  phaseLabel.textContent = `${phase.emoji} ${phase.name}`;
  phaseLabel.style.background = phase.bg;
  phaseLabel.style.color = phase.color;

  // æ³¢æ•°
  document.getElementById('levelNum').textContent = `æŠµæŠ—ç¬¬ ${level} æ³¢`;

  // è¿›åº¦æ¡
  const pct = Math.min((level / 20) * 100, 100);
  const bar = document.getElementById('phaseBar');
  bar.style.width = pct + '%';
  bar.style.background = phase.color;

  // é˜¶æ®µæŒ‡ç¤ºå™¨
  updatePhaseIndicators(level);

  // å†…å®¹
  document.getElementById('battleScene').textContent = line.scene;
  document.getElementById('battleFoodTag').innerHTML = food ? `${food.emoji} ä½ æƒ³åƒçš„ï¼š${food.name} (${food.cal}å¡)` : '';
  document.getElementById('battleCurse').textContent = food ? `åƒäº†${food.name}çš„åæœ...` : line.curse;
  document.getElementById('battleText').textContent = line.text;
  document.getElementById('battleText').style.color = phase.color;

  // é¡µé¢èƒŒæ™¯æ¸å˜
  document.getElementById('page-battle').style.background = `linear-gradient(180deg, ${phase.bg} 0%, var(--bg-dark) 50%)`;

  // æŒ‰é’®æ–‡æ¡ˆéšé˜¶æ®µå˜åŒ–
  const giveUpBtn = document.querySelector('.choice-give-up');
  const continueBtn = document.querySelector('.choice-continue');
  if (level <= 3) {
    giveUpBtn.textContent = 'âœ¨ æˆ‘ä¸åƒäº†ï¼åšå¥³ç¥';
    continueBtn.textContent = 'ğŸ˜¤ ä¸è¡Œï¼Œè¿˜æ˜¯æƒ³åƒ...';
  } else if (level <= 7) {
    giveUpBtn.textContent = 'ğŸ’ª æ”¾ä¸‹ï¼æˆ‘æ¯”é£Ÿæ¬²æ›´å¼º';
    continueBtn.textContent = 'ğŸ¥º å¯æ˜¯çœŸçš„å¥½æƒ³åƒ...';
  } else if (level <= 12) {
    giveUpBtn.textContent = 'ğŸ‘‘ å¤Ÿäº†ï¼æˆ‘é€‰æ‹©å˜ç¾';
    continueBtn.textContent = 'ğŸ˜­ æˆ‘æ§åˆ¶ä¸ä½è‡ªå·±...';
  } else if (level <= 17) {
    giveUpBtn.textContent = 'ğŸ”¥ æˆ‘ç»ä¸è®¤è¾“ï¼';
    continueBtn.textContent = 'ğŸ’€ æˆ‘å·²ç»å¿«å´©æºƒäº†...';
  } else {
    giveUpBtn.textContent = 'ğŸŒŸ é»æ˜å°±åœ¨çœ¼å‰ï¼æˆ‘èµ¢äº†';
    continueBtn.textContent = 'ğŸ˜ˆ å“ªæ€•å»ä¸–ä¹Ÿè¦åƒ...';
  }
}

function nextLevel() {
  state.currentLevel++;

  // ç›²ç›’ï¼šä»ç¬¬5æ³¢å¼€å§‹éšæœºè§¦å‘ï¼Œæ¦‚ç‡é€’å¢
  if (state.currentLevel >= 5) {
    const prob = Math.min(0.12 + (state.currentLevel - 5) * 0.04, 0.55);
    if (Math.random() < prob) {
      showBlindbox();
      return;
    }
  }

  if (state.currentLevel > 20) {
    giveUpEating();
    return;
  }

  renderBattleLevel();
}

function showBlindbox() {
  const card = BLINDBOX_CARDS[Math.floor(Math.random() * BLINDBOX_CARDS.length)];
  document.getElementById('bbBoom').textContent = card.boom;
  document.getElementById('bbTitle').textContent = card.title;
  document.getElementById('bbTitle').style.color = card.color;
  document.getElementById('bbMsg').textContent = card.msg;
  document.getElementById('bbBadge').textContent = `ğŸ… ç°åœ¨æ”¾å¼ƒåƒä¸œè¥¿ï¼Œå¯è·å¾—${card.badge}å¾½ç« `;
  document.getElementById('blindboxCard').style.borderColor = card.color;
  document.getElementById('blindboxOverlay').classList.add('show');
  if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
}

function closeBlindbox() {
  document.getElementById('blindboxOverlay').classList.remove('show');
  if (state.currentLevel > 20) {
    giveUpEating();
  } else {
    renderBattleLevel();
  }
}

function confirmExit() {
  if (confirm('ç¡®å®šè¦é€€å‡ºé—¯å…³å—ï¼Ÿä½ çš„è¿›åº¦ä¸ä¼šä¿å­˜å“¦~')) {
    exitBattle();
  }
}

// ==================== æ”¾å¼ƒåƒä¸œè¥¿ = èƒœåˆ© ====================
function giveUpEating() {
  const wave = state.currentLevel;
  const cal = state.totalCal;
  const fat = (cal / 7700).toFixed(2);

  // è¯„çº§ï¼šæ³¢æ•°è¶Šå°‘è¶Šå¥½
  let grade, emoji;
  if (wave <= 1) { grade = 'â­â­â­â­â­ é—ªç”µå¥³ç¥'; emoji = 'âš¡'; }
  else if (wave <= 3) { grade = 'â­â­â­â­â­ é’¢é“æ„å¿—'; emoji = 'ğŸ‰'; }
  else if (wave <= 7) { grade = 'â­â­â­â­ æ„å¿—åšå®š'; emoji = 'ğŸ’ª'; }
  else if (wave <= 12) { grade = 'â­â­â­ å‹‰å¼ºåˆæ ¼'; emoji = 'ğŸ˜…'; }
  else if (wave <= 17) { grade = 'â­â­ å·®ç‚¹ç¿»è½¦'; emoji = 'ğŸ˜°'; }
  else { grade = 'â­ æ‚¬å´–å‹’é©¬'; emoji = 'ğŸ¥µ'; }

  // ä¿å­˜æ•°æ®
  const prevBadges = [...saveData.badges];
  saveData.totalResists++;
  saveData.totalCalSaved += cal;
  if (wave <= 3) saveData.earlyWins++;
  if (wave === 1) saveData.wave1Wins++;
  if (wave > saveData.maxWave) saveData.maxWave = wave;

  // æ‰“å¡
  const today = new Date().toISOString().slice(0, 10);
  if (saveData.lastDate !== today) {
    if (saveData.lastDate) {
      const last = new Date(saveData.lastDate);
      const now = new Date(today);
      const diff = Math.floor((now - last) / 86400000);
      saveData.streakDays = diff === 1 ? saveData.streakDays + 1 : 1;
    } else {
      saveData.streakDays = 1;
    }
    saveData.lastDate = today;
  }

  saveData.history.push({ date: today, wave, cal, fat: parseFloat(fat) });
  checkBadges();
  save();

  // æ–°è·å¾—çš„å¾½ç« 
  const newBadges = saveData.badges.filter(b => !prevBadges.includes(b));

  // èƒœåˆ©æ ‡é¢˜
  const titles = [
    'è€¶ï¼æˆ‘åˆåšæŒä½äº†ï¼', 'æ­å–œå¥³ç¥ï¼Œä½ èµ¢äº†ï¼', 'å¤ªæ£’äº†ï¼é£Ÿæ¬²è¢«ä½ æ‰“è´¥äº†ï¼',
    'ä»Šæ™šçš„ä½ è¶…çº§æ£’ï¼', 'æ„å¿—åŠ›æ»¡åˆ†é€šå…³ï¼', 'ä½ æ˜¯æœ€ç¾çš„æˆ˜å£«ï¼',
  ];
  const subs = [
    `æ­å–œä½ æˆ˜èƒœäº†æ·±å¤œé£Ÿæ¬²ï¼è·ç¦»99æ–¤åˆè¿‘äº†~ä½ èŠ‚çœäº† ${fat} æ–¤è„‚è‚ªï¼`,
    `æ¯ä¸€æ¬¡å¿ä½éƒ½æ˜¯ç»™æœªæ¥çš„è‡ªå·±æœ€å¥½çš„ç¤¼ç‰©ã€‚ä»Šæ™šçœä¸‹äº† ${cal} åƒå¡ï¼`,
    `ä½ çš„è‡ªå¾‹æ­£åœ¨æ‚„æ‚„æ”¹å˜ä½ ã€‚å°‘é•¿äº† ${fat} æ–¤è‚‰ï¼Œå€¼å¾—åº†ç¥ï¼`,
  ];

  document.getElementById('victoryEmoji').textContent = emoji;
  document.getElementById('victoryTitle').textContent = titles[Math.floor(Math.random() * titles.length)];
  document.getElementById('victorySub').textContent = subs[Math.floor(Math.random() * subs.length)];
  document.getElementById('rptWaves').textContent = wave + ' æ³¢';
  document.getElementById('rptCal').textContent = cal + ' åƒå¡';
  document.getElementById('rptFat').textContent = fat + ' æ–¤';
  document.getElementById('rptGrade').textContent = grade;

  // æ–°å¾½ç« å±•ç¤º
  const badgesEl = document.getElementById('victoryBadges');
  if (newBadges.length > 0) {
    const badgeInfo = newBadges.map(name => {
      const b = BADGES.find(x => x.name === name);
      return b ? `<span class="new-badge">${b.icon} æ–°å¾½ç« ï¼š${b.name}</span>` : '';
    }).join('');
    badgesEl.innerHTML = badgeInfo;
  } else {
    badgesEl.innerHTML = '';
  }

  document.getElementById('victoryOverlay').classList.add('show');
  if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]);
}

function closeVictory() {
  document.getElementById('victoryOverlay').classList.remove('show');
  exitBattle();
}

function exitBattle() {
  state.inBattle = false;
  state.selectedFoods = [];
  state.currentLevel = 1;
  state.usedLines = [];
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-food').classList.add('active');
  document.getElementById('tabBar').classList.add('visible');
  initFoodPage();
  updateStats();
}

// ==================== å¾½ç« æ£€æŸ¥ ====================
function checkBadges() {
  BADGES.forEach(b => {
    if (saveData.badges.includes(b.name)) return;
    let earned = false;
    if (b.need === 'total' && saveData.totalResists >= b.val) earned = true;
    if (b.need === 'streak' && saveData.streakDays >= b.val) earned = true;
    if (b.need === 'early' && saveData.earlyWins >= b.val) earned = true;
    if (b.need === 'wave1' && saveData.wave1Wins >= b.val) earned = true;
    if (b.need === 'cal' && saveData.totalCalSaved >= b.val) earned = true;
    if (b.need === 'maxwave' && saveData.maxWave >= b.val) earned = true;
    if (earned) saveData.badges.push(b.name);
  });
}

// ==================== æˆå°±é¡µ ====================
function renderAchievePage() {
  document.getElementById('achTotal').textContent = saveData.totalResists;
  document.getElementById('achStreak').textContent = saveData.streakDays;
  document.getElementById('achCal').textContent = saveData.totalCalSaved;
  document.getElementById('achFat').textContent = (saveData.totalCalSaved / 7700).toFixed(2);

  // é¼“åŠ±è¯­
  const encourages = [
    {emoji:'ğŸ’ª',text:'ä»Šå¤©åˆæ˜¯å˜ç¾çš„ä¸€å¤©~<br>ä¿æŒä½ï¼Œä½ æ˜¯æœ€æ£’çš„ï¼'},
    {emoji:'ğŸ‘¸',text:'æ­å–œä½ åˆåšæŒäº†ä¸€å¤©ï¼<br>è·ç¦»å¥³ç¥è¶Šæ¥è¶Šè¿‘~'},
    {emoji:'ğŸŒŸ',text:'ä½ çš„è‡ªå¾‹è®©ä½ é—ªé—ªå‘å…‰ï¼<br>ç»§ç»­ä¿æŒè¿™ä»½ç¾ä¸½~'},
    {emoji:'ğŸ‰',text:`ç´¯è®¡æŠµæŠ—${saveData.totalResists}æ¬¡ï¼<br>ä½ ç®€ç›´å¤ªå‰å®³äº†ï¼`},
    {emoji:'ğŸ¦‹',text:`å·²ç»èŠ‚çœ${(saveData.totalCalSaved/7700).toFixed(2)}æ–¤è„‚è‚ªï¼<br>è´è¶æ­£åœ¨ç ´èŒ§~`},
  ];
  const enc = saveData.totalResists > 0
    ? encourages[Math.floor(Math.random() * encourages.length)]
    : {emoji:'ğŸŒ™', text:'è¿˜æ²¡å¼€å§‹é—¯å…³å‘¢~<br>ä»Šæ™šæƒ³åƒä¸œè¥¿å°±æ¥æŒ‘æˆ˜å§ï¼'};
  document.getElementById('encourageCard').innerHTML =
    `<div class="encourage-emoji">${enc.emoji}</div><div class="encourage-text">${enc.text}</div>`;

  // æ‰“å¡æ—¥å†ï¼ˆæœ€è¿‘14å¤©ï¼‰
  const grid = document.getElementById('streakGrid');
  const today = new Date();
  let dots = '';
  for (let i = 13; i >= 0; i--) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    const ds = d.toISOString().slice(0, 10);
    const day = d.getDate();
    const done = saveData.history.some(h => h.date === ds);
    const isToday = i === 0;
    let cls = 'future';
    if (done) cls = 'done';
    else if (isToday) cls = 'today';
    dots += `<div class="streak-dot ${cls}">${day}</div>`;
  }
  grid.innerHTML = dots;

  // å¾½ç« å¢™
  const bg = document.getElementById('badgeGrid');
  bg.innerHTML = BADGES.map(b => {
    const earned = saveData.badges.includes(b.name);
    return `<div class="badge-card${earned ? ' earned' : ' locked'}">
      <div class="badge-icon">${b.icon}</div>
      <div class="badge-name">${b.name}</div>
      <div class="badge-cond">${b.cond}</div>
    </div>`;
  }).join('');
}

// ==================== ä¸»é¢˜åˆ‡æ¢ ====================
function getAutoTheme() {
  const h = new Date().getHours();
  // 6:00-18:00 ç™½å¤©æµ…è‰²ï¼Œ18:00-6:00 å¤œé—´æ·±è‰²
  return (h >= 6 && h < 18) ? 'light' : 'dark';
}

function applyTheme(theme) {
  const meta = document.getElementById('metaThemeColor');
  if (theme === 'light') {
    document.body.classList.add('light');
    document.getElementById('themeToggle').textContent = 'â˜€ï¸';
    if (meta) meta.content = '#FFF5F9';
  } else {
    document.body.classList.remove('light');
    document.getElementById('themeToggle').textContent = 'ğŸŒ™';
    if (meta) meta.content = '#1A1025';
  }
  localStorage.setItem('slim99_theme_manual', theme);
}

function toggleTheme() {
  const isLight = document.body.classList.contains('light');
  applyTheme(isLight ? 'dark' : 'light');
}

// åˆå§‹åŒ–ä¸»é¢˜ï¼šä¼˜å…ˆç”¨æ‰‹åŠ¨è®¾ç½®ï¼Œå¦åˆ™æŒ‰æ—¶é—´è‡ªåŠ¨
(function initTheme() {
  const manual = localStorage.getItem('slim99_theme_manual');
  // å¦‚æœç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢è¿‡ï¼Œåœ¨åŒä¸€æ—¶æ®µå†…ä¿æŒæ‰‹åŠ¨é€‰æ‹©
  // å¦åˆ™æŒ‰æ—¶é—´è‡ªåŠ¨åˆ‡æ¢
  if (manual) {
    applyTheme(manual);
  } else {
    applyTheme(getAutoTheme());
  }
  // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ—¶é—´ï¼Œè‡ªåŠ¨åˆ‡æ¢ï¼ˆä»…åœ¨æœªæ‰‹åŠ¨è®¾ç½®æ—¶ï¼‰
  setInterval(() => {
    if (!localStorage.getItem('slim99_theme_manual_lock')) {
      applyTheme(getAutoTheme());
    }
  }, 60000);
})();

// ==================== åˆå§‹åŒ– ====================
(function checkStreak() {
  const today = new Date().toISOString().slice(0, 10);
  if (saveData.lastDate && saveData.lastDate !== today) {
    const last = new Date(saveData.lastDate);
    const now = new Date(today);
    const diff = Math.floor((now - last) / 86400000);
    if (diff > 1) saveData.streakDays = 0;
    save();
  }
})();
</script>
</body>
</html>